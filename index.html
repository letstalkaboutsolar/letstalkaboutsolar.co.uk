<!DOCTYPE html>
<html lang="en">
<head>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC0y8SNlXSgKW0aHxXofroM4_aPqzaIrFQ&libraries=places&callback=mapsApiLoaded" async defer></script>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Let’s Talk About Solar</title>
  <meta name="description" content="Clear, friendly, and honest solar advice for UK homeowners. Discover real savings, trusted installers, and smart solar tools." />
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #6ec6ff;
      --primary-dark: #2196f3;
      --secondary: #18475f;
      --accent: #ffd700;
      --white: #ffffff;
      --gray-bg: #f5faff;
      --card: rgba(255,255,255,0.97);
      --soft-shadow: 0 2px 14px 0 #97cdfd33;
      --radius: 24px;
      --premium-gloss: linear-gradient(120deg, #eaf7ff 0%, #d7edff 50%, #fff 100%);
    }
    * { box-sizing: border-box; }
    html, body {
      margin: 0;
      padding: 0;
      background: var(--gray-bg);
      font-family: 'Roboto', 'Segoe UI', Arial, sans-serif;
      color: var(--secondary);
      scroll-behavior: smooth;
    }
    nav {
      position: fixed;
      top: 0;
      width: 100%;
      background: var(--premium-gloss);
      box-shadow: 0 3px 22px 0 #aac5e855, 0 1px 0 #6ec6ff;
      padding: 1.15rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 100;
      transition: top 0.3s;
      border-bottom: 2.5px solid #b2daff;
    }
    nav.hidden { top: -100px; }
    .logo {
      font-size: 1.7rem;
      font-weight: bold;
      color: var(--primary-dark);
      letter-spacing: 1px;
      filter: drop-shadow(0 2px 8px #b2daff55);
      text-shadow: 0 2px 16px #b2daff44;
      font-family: 'Roboto', 'Segoe UI', Arial, sans-serif;
      background: linear-gradient(90deg, #2196f3 0%, #6ec6ff 80%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    nav ul {
      list-style: none;
      display: flex;
      gap: 1.4rem;
      margin: 0;
      padding: 0;
    }
    nav ul li a {
      text-decoration: none;
      color: var(--secondary);
      font-size: 1.08rem;
      padding: 0.5rem 1.1rem;
      border-radius: 999px;
      transition: background 0.18s, color 0.18s;
      background: rgba(110,198,255,0.08);
      font-weight: 500;
    }
    nav ul li a.cta-nav {
      background: var(--primary-dark);
      color: var(--white);
      font-weight: 700;
      box-shadow: 0 2px 9px #2196f333;
    }
    nav ul li a:hover,
    nav ul li a.cta-nav:hover {
      background: var(--accent);
      color: var(--primary-dark);
    }
    .nav-hamburger {
      display: none;
      background: none;
      border: none;
      cursor: pointer;
      padding: 0.5em;
      margin-left: 0.5em;
      z-index: 120;
    }
    .nav-hamburger span,
    .nav-hamburger span::before,
    .nav-hamburger span::after {
      display: block;
      background: var(--primary-dark);
      height: 3.5px;
      border-radius: 2px;
      width: 32px;
      position: relative;
      transition: 0.22s;
    }
    .nav-hamburger span::before,
    .nav-hamburger span::after {
      content: "";
      position: absolute;
      left: 0;
      width: 32px;
      height: 3.5px;
      border-radius: 2px;
      background: var(--primary-dark);
      transition: 0.22s;
    }
    .nav-hamburger span::before { top: -9px; }
    .nav-hamburger span::after { top: 9px; }
    .nav-hamburger[aria-expanded="true"] span { background: transparent; }
    .nav-hamburger[aria-expanded="true"] span::before {
      transform: rotate(45deg) translate(7px,7px);
      top: 0;
    }
    .nav-hamburger[aria-expanded="true"] span::after {
      transform: rotate(-45deg) translate(7px,-7px);
      top: 0;
    }
    .mobile-nav {
      display: none;
    }
    .mobile-nav.open {
      display: flex;
      flex-direction: column;
      position: absolute;
      top: 100%;
      left: 0;
      width: 100vw;
      background: var(--premium-gloss);
      box-shadow: 0 8px 32px #b2daff66, 0 4px 14px #ffd70022;
      border-bottom: 2.5px solid #b2daff;
      z-index: 110;
      animation: fadeIn .22s;
    }
    .mobile-nav ul {
      list-style: none;
      margin: 0;
      padding: 1.2em 0;
      display: flex;
      flex-direction: column;
      gap: 0.2em;
      align-items: stretch;
    }
    .mobile-nav ul li {
      width: 100%;
      text-align: left;
    }
    .mobile-nav ul li a {
      display: block;
      width: 100%;
      padding: 1em 2em;
      font-size: 1.16rem;
      background: none;
      border-radius: 0;
      margin: 0;
      border: none;
      color: var(--primary-dark);
      font-weight: bold;
      transition: background 0.18s, color 0.18s;
    }
    .mobile-nav ul li a.cta-nav {
      background: var(--primary-dark);
      color: var(--white);
      font-weight: 700;
      border-radius: 0;
      box-shadow: none;
    }
    .mobile-nav ul li a:hover,
    .mobile-nav ul li a.cta-nav:hover {
      background: var(--accent);
      color: var(--primary-dark);
    }
    @media (max-width: 900px) {
      nav ul {
        display: none;
      }
      .nav-hamburger {
        display: block;
      }
      .mobile-nav {
        display: none;
      }
      .mobile-nav.open {
        display: flex;
      }
    }
    @media (min-width: 901px) {
      .mobile-nav { display: none !important; }
      .nav-hamburger { display: none !important; }
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translate(-50%, 1.5em);}
      to { opacity: 1; transform: translate(-50%, .5em);}
    }
    /* All your existing CSS below remains unchanged */
        /* ...your existing CSS continues here unchanged... */
  </style>
</head>
<body>
  <nav id="navbar">
    <div class="logo">Let’s Talk About Solar</div>
    <!-- Hamburger button for mobile nav -->
    <button class="nav-hamburger" id="nav-hamburger" aria-label="Open navigation menu" aria-expanded="false" tabindex="0">
      <span></span>
    </button>
    <ul>
      <li><a href="#hero">Home</a></li>
      <li><a href="#about">About Us</a></li>
      <li><a href="#benefits">Why Solar?</a></li>
      <li><a href="#solar-toolkit" id="nav-orientation">Orientation</a></li>
      <li><a href="#solar-toolkit" id="nav-calculator">Savings</a></li>
      <li><a href="#trust">Trust</a></li>
      <li><a href="#facebook-profile-thread" class="cta-nav">FB Feed</a></li>
      <li><a href="#quote" class="cta-nav">Get Quote</a></li>
    </ul>
    <!-- Mobile nav overlay -->
    <div class="mobile-nav" id="mobile-nav">
      <ul>
        <li><a href="#hero" class="mobile-nav-link">Home</a></li>
        <li><a href="#about" class="mobile-nav-link">About Us</a></li>
        <li><a href="#benefits" class="mobile-nav-link">Why Solar?</a></li>
        <li><a href="#solar-toolkit" id="mnav-orientation" class="mobile-nav-link">Orientation</a></li>
        <li><a href="#solar-toolkit" id="mnav-calculator" class="mobile-nav-link">Savings</a></li>
        <li><a href="#trust" class="mobile-nav-link">Trust</a></li>
        <li><a href="#facebook-profile-thread" class="cta-nav mobile-nav-link">FB Feed</a></li>
        <li><a href="#quote" class="cta-nav mobile-nav-link">Get Quote</a></li>
      </ul>
    </div>
  </nav>

  <section class="hero" id="hero">
    <div class="hero-text">
      <h1>Sunshine Meets Smart Savings</h1>
      <p>See how solar can protect your bills and power your future.</p>
      <a href="#quote" class="cta">Get My Free Quote</a>
    </div>
  </section>

  <!-- ABOUT US SECTION -->
  <section id="about" class="about-section">
    <h2>About Us</h2>
    <p>
      At <strong>Let’s Talk About Solar</strong>, we believe that solar power should be simple, affordable, and transparent for every UK homeowner. We're not here to push products — we're here to provide real, honest advice that helps you make the best decision for your home and your future.
    </p>
    <p>
      We’re passionate about helping families reduce their energy bills, protect themselves from rising prices, and generate clean energy using trusted technologies. Our mission is to remove confusion from the solar process by offering clear tools, free advice, and access to certified local installers you can rely on.
    </p>
    <p>
      Whether you’re just starting to explore solar or you’re ready to get a quote, we’re here to support you every step of the way.
    </p>
    <span class="about-highlight">
      No jargon. No pressure. Just solar made simple.
    </span>
    <hr>
    <div style="text-align:center; margin-top:1.5em;">
      For a comprehensive quotation directly from us, fill out the <a href="#quote" style="color:#2196f3;font-weight:bold;text-decoration:underline;">free quotation form</a>.
    </div>
  </section>
  <!-- END ABOUT US SECTION -->

  <section id="benefits" class="section">
    <h2>Why Solar?</h2>
    <div class="benefit-cards">
      <div class="benefit-card">
        <img src="https://cdn-icons-png.flaticon.com/512/3135/3135715.png" alt="Money saving GBP icon">
        <p>Save money on your bills from day one.</p>
      </div>
      <div class="benefit-card">
        <img src="https://cdn-icons-png.flaticon.com/512/3103/3103446.png" alt="Battery storage icon">
        <p>Store your sunshine with battery technology.</p>
      </div>
      <div class="benefit-card">
        <img src="https://cdn-icons-png.flaticon.com/512/2422/2422625.png" alt="Pylon selling to grid icon">
        <p>Sell your surplus energy back to the grid.</p>
      </div>
    </div>
  </section>
    <section id="solar-toolkit" class="section">
    <div>
      <h2>Check Your Roof Orientation</h2>
      <input id="addressInput" type="text" placeholder="Enter your address" style="max-width:350px;margin:0 auto 1rem auto;display:block;" />
      <button id="toggleMapBtn" onclick="toggleStreetView()" style="margin:1rem 0 1.2rem 0;padding:0.7rem 1.3rem;border-radius:999px;background:linear-gradient(90deg,#6ec6ff,#2196f3);color:#fff;font-weight:700;font-size:1rem;border:none;box-shadow:0 2px 8px #6ec6ff40;cursor:pointer;">
        Show Street View
      </button>
      <div id="streetview-container" style="width:100%;max-width:400px;height:200px;display:none;border-radius:18px;overflow:hidden;margin:0 auto 1rem auto;background:#eaf7ff;">
        <div id="pano" style="width:100%;height:100%;"></div>
      </div>
      <p id="orientationResult" style="margin-top: 1rem; font-weight: bold;"></p>
    </div>
    <div>
      <h2>Solar Savings Calculator</h2>
      <form id="calcForm" class="calculator">
        <label for="rate">Electricity unit rate (p/kWh):</label>
        <input type="number" id="rate" placeholder="e.g. 25" required>
        <label for="standing">Standing charge (p/day):</label>
        <input type="number" id="standing" placeholder="e.g. 60" required>
        <label for="usage">Annual electricity usage (kWh):</label>
        <input type="number" id="usage" placeholder="e.g. 4000" required>
        <label for="battery-size">Battery size:</label>
        <select id="battery-size">
          <option value="0">No battery</option>
          <option value="5">5 kWh battery</option>
          <option value="10">10 kWh battery</option>
        </select>
        <div class="presence-radio-group">
          <label class="home">
            <input type="radio" name="dayPresence" id="homeDay" value="home" checked>
            I'm home during the day
          </label>
          <label class="out">
            <input type="radio" name="dayPresence" id="outDay" value="out">
            I'm out during the day
          </label>
        </div>
        <button type="submit">Calculate</button>
      </form>
      <div id="calcResult"></div>
    </div>
  </section>

  <section id="finance-offset-section" class="finance-offset-section" style="display:none;">
    <h2 style="text-align:center;">Finance & Bill Offset Illustration</h2>
    <form id="depositForm" class="inline-form" autocomplete="off" style="text-align:center;margin-bottom:1.2em;">
      <label for="deposit-amount">Deposit (£):</label>
      <input type="number" id="deposit-amount" value="0" min="0" max="20000" step="100">
      <label for="finance-system-cost">System cost (£):</label>
      <input type="number" id="finance-system-cost" value="9500" min="2000" max="20000" step="100">
      <button type="submit" style="background:linear-gradient(90deg,#6ec6ff,#2196f3);color:#fff;padding:0.4em 1.3em;border-radius:999px;border:none;cursor:pointer;">Recalculate</button>
    </form>
    <div id="finance-offset-summary" class="finance-summary"></div>
    <div class="disclaimer" style="margin-top:1.4em;color:#b7a23a;">
      <strong>Disclaimer:</strong> This illustration uses typical finance terms and current savings estimates for guidance only.
      Actual bills, savings, and finance rates may vary. Please consult a financial adviser for tailored advice.
    </div>
  </section>

  <section id="historic-prices" class="section">
    <button onclick="toggleHistoric()" style="font-size:1.1rem;padding:0.5rem 1.5rem;background:linear-gradient(90deg,#6ec6ff,#2196f3);color:#fff;border:none;border-radius:20px;cursor:pointer;">
      Show Historic Electricity Prices (2000-2025)
    </button>
    <div id="historic-graph" style="display:none;margin-top:2rem;">
      <canvas id="pricesChart" width="400" height="200"></canvas>
      <p style="font-size:0.9rem;color:gray;">
        Sources: 
        <a href="https://www.gov.uk/government/statistical-data-sets/annual-domestic-energy-price-statistics" target="_blank">UK Government</a>, 
        <a href="https://www.ons.gov.uk/economy/inflationandpriceindices/datasets/consumerpriceindices" target="_blank">Office for National Statistics (ONS)</a>, 
        <a href="https://www.ofgem.gov.uk/energy-data-and-research/data-portal/retail-market-indicators" target="_blank">Ofgem</a>
      </p>
    </div>
  </section>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  
  <section id="trust" class="section">
    <h2 style="color:var(--primary-dark);font-size:2rem;font-weight:700;">Who Can You Trust?</h2>
    <div class="trust-cards">
      <!-- ... trust cards unchanged ... -->
      <div class="accredit-card" tabindex="0">
        <button class="accredit-card-btn" type="button" aria-expanded="false">
          <img src="assets/mcs logo.png" alt="MCS Certified" />
          <span>MCS</span>
        </button>
        <div class="accredit-card-desc">
          <strong>MCS (Microgeneration Certification Scheme):</strong><br>
          Guarantees your installer and solar products meet strict UK quality and safety standards. MCS certification is required for eligibility for government incentives and ensures your installation is reliable and high performing.
        </div>
      </div>
      <div class="accredit-card" tabindex="0">
        <button class="accredit-card-btn" type="button" aria-expanded="false">
          <img src="assets/epvs logi.jpeg" alt="EPVS" />
          <span>EPVS</span>
        </button>
        <div class="accredit-card-desc">
          <strong>EPVS (Energy Performance Validation Scheme):</strong><br>
          Protects you from misleading sales claims by ensuring all performance figures and savings estimates from your installer are independently validated and accurate.
        </div>
      </div>
      <div class="accredit-card" tabindex="0">
        <button class="accredit-card-btn" type="button" aria-expanded="false">
          <img src="assets/hies-cc-logo-2.png" alt="HIES" />
          <span>HIES</span>
        </button>
        <div class="accredit-card-desc">
          <strong>HIES (Home Insulation & Energy Systems):</strong><br>
          Provides consumer protection including deposit and warranty insurance, dispute resolution, and ensures you’re covered if anything goes wrong with your solar purchase.
        </div>
      </div>
      <div class="accredit-card" tabindex="0">
        <button class="accredit-card-btn" type="button" aria-expanded="false">
          <img src="assets/NAPIT-NEW-LOGO.jpg" alt="NAPIT" />
          <span>NAPIT</span>
        </button>
        <div class="accredit-card-desc">
          <strong>NAPIT (National Association of Professional Inspectors and Testers):</strong><br>
          Certifies electrical safety and compliance of your installer, ensuring your solar system is installed to the latest regulations and standards.
        </div>
      </div>
      <div class="accredit-card" tabindex="0">
        <button class="accredit-card-btn" type="button" aria-expanded="false">
          <img src="assets/trading-standards-uk-logo.png" alt="Trading Standards" />
          <span>Trading Standards</span>
        </button>
        <div class="accredit-card-desc">
          <strong>Trading Standards:</strong><br>
          Ensures solar businesses comply with UK consumer laws and codes of practice, protecting you from unfair sales and poor business practices.
        </div>
      </div>
      <div class="accredit-card" tabindex="0">
        <button class="accredit-card-btn" type="button" aria-expanded="false">
          <img src="assets/tm_primary_logo_rgb.jpg" alt="TrustMark" />
          <span>TrustMark</span>
        </button>
        <div class="accredit-card-desc">
          <strong>TrustMark:</strong><br>
          Government-endorsed scheme ensuring your solar installer is thoroughly vetted for quality, customer service, and trading practices.
        </div>
      </div>
      <div class="accredit-card" tabindex="0">
        <button class="accredit-card-btn" type="button" aria-expanded="false">
          <img src="assets/Financial_Conduct_Authority_logo.svg.png" alt="FCA" />
          <span>FCA</span>
        </button>
        <div class="accredit-card-desc">
          <strong>FCA (Financial Conduct Authority):</strong><br>
          Regulates finance providers and credit agreements, protecting you if you choose to finance your solar system, ensuring fair, clear, and legal financial products.
        </div>
      </div>
    </div>
  </section>

  <!-- Facebook Profile Thread Section -->
  <section id="facebook-profile-thread" class="section">
    <h2 style="color:var(--primary-dark);text-align:center;">Our Latest on Facebook</h2>
    <div style="display:flex;justify-content:center;">
      <div class="fb-page"
        data-href="https://www.facebook.com/profile.php?id=61576873361260"
        data-tabs="timeline"
        data-width="400"
        data-height="600"
        data-small-header="false"
        data-adapt-container-width="true"
        data-hide-cover="false"
        data-show-facepile="true">
        <blockquote cite="https://www.facebook.com/profile.php?id=61576873361260" class="fb-xfbml-parse-ignore">
          <a href="https://www.facebook.com/profile.php?id=61576873361260">Let’s Talk About Solar</a>
        </blockquote>
      </div>
    </div>
  </section>

  <section id="quote" class="section">
    <h2>Request a Free Quote</h2>
    <form action="https://formspree.io/f/mldnarjp" method="POST" class="quote-form">
      <input type="text" name="name" placeholder="Full Name" required autocomplete="name">
      <input type="text" name="address" id="quote-address" placeholder="Start typing your address…" required autocomplete="street-address">
      <input type="email" name="email" placeholder="Email Address" required autocomplete="email">
      <input type="tel" name="phone" placeholder="Phone Number" required autocomplete="tel">
      <input type="text" name="unitrate" placeholder="Electricity Unit Rate (p/kWh)" required>
      <input type="text" name="annualspend" placeholder="Annual Electricity Spend (£)" required>
      <button type="submit">Send My Quote Request</button>
    </form>
  </section>

  <footer>
    <p>&copy; 2025 Let’s Talk About Solar. All rights reserved.</p>
  </footer>

  <!-- Facebook SDK for Page Plugin -->
  <div id="fb-root"></div>
  <script async defer crossorigin="anonymous" src="https://connect.facebook.net/en_GB/sdk.js#xfbml=1&version=v19.0" nonce="letstalksolar"></script>

  <!-- Hamburger/mobile nav, smooth scroll, and all your original JS, next part -->
    <script>
    // --- NAVIGATION: Hide on scroll, Hamburger menu, Mobile overlay, Smooth scroll ---
    let lastScroll = 0;
    const nav = document.getElementById("navbar");

    window.addEventListener("scroll", () => {
      const currentScroll = window.pageYOffset;
      nav.classList.toggle("hidden", currentScroll > lastScroll);
      lastScroll = currentScroll;
    });

    // Hamburger menu logic
    const navHamburger = document.getElementById('nav-hamburger');
    const mobileNav = document.getElementById('mobile-nav');
    function closeMobileNav() {
      navHamburger.setAttribute('aria-expanded', 'false');
      mobileNav.classList.remove('open');
      document.body.style.overflow = '';
    }
    navHamburger.addEventListener('click', function (e) {
      const expanded = navHamburger.getAttribute('aria-expanded') === "true";
      navHamburger.setAttribute('aria-expanded', expanded ? "false" : "true");
      mobileNav.classList.toggle("open", !expanded);
      document.body.style.overflow = !expanded ? 'hidden' : '';
      if (!expanded) {
        setTimeout(() => mobileNav.querySelector('a')?.focus(), 200);
      }
    });
    mobileNav.addEventListener('click', function (e) {
      if (e.target.classList.contains('mobile-nav-link')) {
        closeMobileNav();
      }
    });
    document.addEventListener('click', function (e) {
      if (!mobileNav.contains(e.target) && !navHamburger.contains(e.target)) {
        closeMobileNav();
      }
    });
    window.addEventListener('resize', function () {
      if (window.innerWidth > 900) closeMobileNav();
    });

    // Smooth scroll for toolkit anchors ("Orientation" and "Savings")
    function smoothScrollToToolkit(focusSelector) {
      const container = document.getElementById('solar-toolkit');
      if (container) {
        const top = container.getBoundingClientRect().top + window.scrollY - 80;
        window.scrollTo({ top, behavior: 'smooth' });
        setTimeout(() => {
          if (focusSelector) document.querySelector(focusSelector)?.focus();
        }, 500);
      }
    }
    document.addEventListener("DOMContentLoaded", function () {
      // Desktop nav
      document.getElementById('nav-orientation').addEventListener('click', function (e) {
        e.preventDefault();
        smoothScrollToToolkit('#addressInput');
      });
      document.getElementById('nav-calculator').addEventListener('click', function (e) {
        e.preventDefault();
        smoothScrollToToolkit('#rate');
      });
      // Mobile nav
      document.getElementById('mnav-orientation').addEventListener('click', function (e) {
        e.preventDefault();
        closeMobileNav();
        setTimeout(() => smoothScrollToToolkit('#addressInput'), 100);
      });
      document.getElementById('mnav-calculator').addEventListener('click', function (e) {
        e.preventDefault();
        closeMobileNav();
        setTimeout(() => smoothScrollToToolkit('#rate'), 100);
      });
    });

    // --- ORIENTATION / GOOGLE MAPS / AUTOCOMPLETE ---
    let orientationFactor = 1;
    let autocomplete, lastPlaceLocation = null, panoMap = null;
    function mapsApiLoaded() {
      if (typeof initMap === "function") initMap();
      if (typeof initQuoteAddressAutocomplete === "function") initQuoteAddressAutocomplete();
    }
    function initMap() {
      const input = document.getElementById("addressInput");
      autocomplete = new google.maps.places.Autocomplete(input, {
        componentRestrictions: { country: 'uk' },
        fields: ["geometry", "formatted_address", "address_components"],
        types: ["address"]
      });
      autocomplete.addListener("place_changed", () => {
        const place = autocomplete.getPlace();
        if (!place.geometry || !place.geometry.location) {
          alert("No details available for input: '" + place.name + "'");
          lastPlaceLocation = null;
          return;
        }
        lastPlaceLocation = place.geometry.location;
        // Orientation logic
        const viewport = place.geometry.viewport;
        let orientation = "Unknown";
        let explanation = "";
        orientationFactor = 0.9;

        if (viewport) {
          const ne = viewport.getNorthEast();
          const sw = viewport.getSouthWest();
          const angle = Math.atan2(ne.lat() - sw.lat(), ne.lng() - sw.lng()) * (180 / Math.PI);

          if (angle > -45 && angle <= 45) {
            orientation = "East";
            orientationFactor = 0.85;
            explanation = "Your front roof likely faces East and the rear West. A solar system can still work well with morning sunlight.";
          } else if (angle > 45 && angle <= 135) {
            orientation = "North";
            orientationFactor = 0.75;
            explanation = "Your front roof likely faces North and the rear South. South-facing roofs are ideal for solar.";
          } else if (angle > -135 && angle <= -45) {
            orientation = "South";
            orientationFactor = 1.0;
            explanation = "Your front roof likely faces South and the rear North. This is excellent for solar efficiency.";
          } else {
            orientation = "West";
            orientationFactor = 0.8;
            explanation = "Your front roof likely faces West and the rear East. Good for catching late afternoon sunlight.";
          }
        }

        document.getElementById("orientationResult").innerHTML =
          `<strong>Estimated Roof Orientation:</strong> ${orientation}<br><em>${explanation}</em>`;
      });
    }
    function initQuoteAddressAutocomplete() {
      var input = document.getElementById('quote-address');
      if (!input) return;
      var options = {
        componentRestrictions: { country: 'uk' },
        fields: ["formatted_address", "geometry"],
        types: ["address"]
      };
      var autocomplete = new google.maps.places.Autocomplete(input, options);
      autocomplete.setBounds(new google.maps.LatLngBounds(
        new google.maps.LatLng(49.9, -7.6),
        new google.maps.LatLng(58.7, 1.8)
      ));
    }
    function toggleStreetView() {
      const container = document.getElementById("streetview-container");
      const btn = document.getElementById("toggleMapBtn");
      if (container.style.display === 'none' || container.style.display === '') {
        if (!lastPlaceLocation) {
          alert("Please enter your address and select it from the dropdown first.");
          return;
        }
        container.style.display = "block";
        if (!panoMap) {
          panoMap = new google.maps.StreetViewPanorama(
            document.getElementById("pano"),
            {
              position: lastPlaceLocation,
              pov: { heading: 165, pitch: 0 },
              zoom: 1
            }
          );
        } else {
          panoMap.setPosition(lastPlaceLocation);
        }
        btn.innerText = "Hide Street View";
      } else {
        container.style.display = "none";
        btn.innerText = "Show Street View";
      }
    }

    // --- SOLAR CALCULATOR ---
    let latestSavingsPerYear = 0;
    let latestAnnualSpend = 0;
    let latestSystemCost = 9500;
    function syncSystemCostFields(value) {
      document.getElementById('finance-system-cost').value = value;
    }
    document.addEventListener('DOMContentLoaded', function() {
      syncSystemCostFields('9500');
    });
    document.getElementById("calcForm").addEventListener("submit", function (e) {
      e.preventDefault();
      const rate = parseFloat(document.getElementById("rate").value);
      const standing = parseFloat(document.getElementById("standing").value);
      const usage = parseFloat(document.getElementById("usage").value);
      const batterySize = parseInt(document.getElementById("battery-size").value, 10); // 0, 5, 10
      const homeAllDay = document.getElementById("homeDay").checked;

      // Solar generation constants
      const systemSizeKW = 3.68;
      const panelSystemKW = 9 * 0.46;
      const kwhPerKWp = 1050;
      const estimatedAnnualGen = Math.min(systemSizeKW, panelSystemKW) * kwhPerKWp * orientationFactor;

      // Self-consumption ratios
      let baseSelfConsumption = homeAllDay ? 0.65 : 0.4;
      let batterySelfConsumption = 0;
      if (batterySize === 5) {
        batterySelfConsumption = homeAllDay ? 0.8 : 0.6;
      } else if (batterySize === 10) {
        batterySelfConsumption = homeAllDay ? 0.9 : 0.7;
      }
      const selfConsumptionRatio = batterySize === 0 ? baseSelfConsumption : batterySelfConsumption;

      // Calculate actual self-used and exported
      let selfUsedKWh = Math.min(usage, estimatedAnnualGen * selfConsumptionRatio);
      let exportKWh = Math.max(0, estimatedAnnualGen - selfUsedKWh);
      if (usage < estimatedAnnualGen * selfConsumptionRatio) {
        exportKWh = estimatedAnnualGen - usage;
        selfUsedKWh = usage;
      }

      // Bill and savings calculations
      const annualStanding = standing * 365 / 100;
      const billUsage = rate * usage / 100;
      const annualSpend = billUsage + annualStanding;
      latestAnnualSpend = annualSpend;

      // Yearly savings and export calculations
      let annualSavingsArr = [];
      let price = rate;
      let exportRate = 16.5;
      let cumulative = 0;
      let exportIncomeCumulative = 0;
      for (let year = 1; year <= 10; year++) {
        let yearSavings = (selfUsedKWh * price) / 100;
        let yearExportIncome = (exportKWh * exportRate) / 100;
        cumulative += yearSavings;
        exportIncomeCumulative += yearExportIncome;
        annualSavingsArr.push({
          year,
          price: price.toFixed(2),
          savings: yearSavings.toFixed(2),
          exportIncome: yearExportIncome.toFixed(2),
          cumulative: cumulative.toFixed(2),
          exportCumulative: exportIncomeCumulative.toFixed(2)
        });
        price *= 1.0704;
      }
      let tableRows = annualSavingsArr.map(row =>
        `<tr>
          <td>Year ${row.year}</td>
          <td>£${row.savings}</td>
          <td>£${row.exportIncome}</td>
          <td>${row.price}p/kWh</td>
          <td>£${row.cumulative}</td>
          <td>£${row.exportCumulative}</td>
        </tr>`
      ).join('');
      const presenceText = homeAllDay
        ? "You're home during the day"
        : "You're out during the day";
      const batteryDesc = batterySize > 0 ? ` with ${batterySize}kWh battery` : "";
      const calcResult = document.getElementById("calcResult");
      latestSavingsPerYear = parseFloat(annualSavingsArr[0].savings);

      calcResult.innerHTML = `
        <div style="margin-bottom:1.1em;">
          <h3>Estimated Annual Savings (Year 1): £${annualSavingsArr[0].savings}</h3>
          <p>Your system is estimated to generate <strong>${estimatedAnnualGen.toFixed(0)} kWh</strong> per year.</p>
          <p>Annual self-used solar: <strong>${selfUsedKWh.toFixed(0)} kWh</strong> (${(100*selfUsedKWh/usage).toFixed(0)}% of your usage${batteryDesc}, ${presenceText})</p>
          <p>Annual solar export: <strong>${exportKWh.toFixed(0)} kWh</strong>
            <br>Value of exported energy at 16.5p/kWh: <strong>£${((exportKWh*exportRate)/100).toFixed(2)}</strong>
          </p>
          <p><b>Your annual energy spend (inc. standing charge): £${annualSpend.toFixed(2)}</b></p>
        </div>
        <h4>Projected Savings and Export Over 10 Years (with 7.04% price increase per year):</h4>
        <table style="margin:auto;border-collapse:collapse;">
          <tr>
            <th>Year</th>
            <th>Bill Savings</th>
            <th>Export Income</th>
            <th>Price per kWh</th>
            <th>Cumulative Savings</th>
            <th>Cumulative Export</th>
          </tr>
          ${tableRows}
        </table>
        <p style="font-size:0.95em;color:#888;">This calculation is based on a system with 9 solar panels – if your roof can fit more, your potential savings will be even higher. These are estimated figures based on typical UK conditions. For a free comprehensive breakdown, fill in the free quote form.</p>
      `;

      showFinanceOffset();
    });

    function showFinanceOffset() {
      const section = document.getElementById("finance-offset-section");
      section.style.display = "block";
      updateFinanceOffset();
    }

    function updateFinanceOffset() {
      const systemCostInput = document.getElementById("finance-system-cost");
      const depositInput = document.getElementById("deposit-amount");
      const installCost = parseFloat(systemCostInput?.value) || latestSystemCost || 9500;
      const deposit = parseFloat(depositInput?.value) || 0;
      if (deposit > installCost) {
        depositInput.value = installCost;
      }
      const loanAmount = installCost - deposit;
      const years = 10;
      const n = years * 12;
      const rate = 0.099;
      const monthlyRate = rate / 12;
      let monthly = (loanAmount * monthlyRate) / (1 - Math.pow(1 + monthlyRate, -n));
      const totalFinance = (monthly * n) + deposit;

      const savingsPerYear = latestSavingsPerYear || 800;
      const savingsPerMonth = savingsPerYear / 12;
      const totalSavings10y = savingsPerYear * years;
      const annualSpend = latestAnnualSpend || 1200;
      const totalElec10y = annualSpend * years;

      const netMonthly = monthly - savingsPerMonth;
      const net10y = (monthly * n) - totalSavings10y + deposit;
      const diff = totalElec10y - net10y;

      const summary = `
        <p>
          <b>Typical system cost:</b> £${installCost.toLocaleString()}
          &nbsp; <b>Deposit:</b> £${deposit.toLocaleString()}<br>
          <b>Monthly finance payment:</b> £${monthly.toFixed(2)}<br>
          <b>Estimated average monthly savings:</b> £${savingsPerMonth.toFixed(2)}
        </p>
        <p>
          <b>Net outgoing (finance payment minus savings):</b> <span>${netMonthly > 0 ? "£"+netMonthly.toFixed(2)+"/month" : "<span class='diff-positive'>£"+netMonthly.toFixed(2)+"/month</span>"}</span>
        </p>
        <hr>
        <p>
          <b>Total cost with solar & finance over 10 years:</b> £${net10y.toFixed(2)}<br>
          <b>Total paid for electricity (no solar) over 10 years:</b> £${totalElec10y.toFixed(2)}<br>
          <b>Difference:</b> <span class="${diff > 0 ? 'diff-positive' : 'diff-negative'}">${diff > 0 ? "You save £"+diff.toFixed(2) : "Solar+finance costs £"+Math.abs(diff).toFixed(2)+" more"}</span>
        </p>
      `;
      document.getElementById("finance-offset-summary").innerHTML = summary;
    }

    document.getElementById("depositForm").addEventListener("submit", function(e){
      e.preventDefault();
      updateFinanceOffset();
    });

    document.getElementById('finance-system-cost').addEventListener('input', function(e) {
      syncSystemCostFields(e.target.value);
    });

    // --- HISTORIC PRICE CHART ---
    function toggleHistoric() {
      let g = document.getElementById('historic-graph');
      g.style.display = (g.style.display === 'none' || g.style.display === '') ? 'block' : 'none';
      if (g.style.display === 'block' && !window._historicChartLoaded) {
        drawPriceChart();
        window._historicChartLoaded = true;
      }
    }
    function drawPriceChart() {
      const ctx = document.getElementById('pricesChart').getContext('2d');
      const years = [
        2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,
        2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,
        2020,2021,2022,2023,2024,2025
      ];
      const prices = [
        7.0,7.3,7.2,7.1,7.4,8.2,10.0,10.6
          <script>
    // Navbar show/hide and mobile nav logic
    let lastScroll = 0;
    const nav = document.getElementById("navbar");
    let orientationFactor = 1;

    window.addEventListener("scroll", () => {
      const currentScroll = window.pageYOffset;
      nav.classList.toggle("hidden", currentScroll > lastScroll);
      lastScroll = currentScroll;
    });

    // --- Mobile Hamburger Dropdown & Smooth Scroll Logic ---
    const navHamburger = document.getElementById('nav-hamburger');
    const mobileNav = document.getElementById('mobile-nav');
    function closeMobileNav() {
      navHamburger.setAttribute('aria-expanded', 'false');
      mobileNav.classList.remove('open');
      document.body.style.overflow = '';
    }
    navHamburger.addEventListener('click', function (e) {
      const expanded = navHamburger.getAttribute('aria-expanded') === "true";
      navHamburger.setAttribute('aria-expanded', expanded ? "false" : "true");
      mobileNav.classList.toggle("open", !expanded);
      document.body.style.overflow = !expanded ? 'hidden' : '';
      if (!expanded) {
        setTimeout(() => mobileNav.querySelector('a')?.focus(), 200);
      }
    });
    mobileNav.addEventListener('click', function (e) {
      if (e.target.classList.contains('mobile-nav-link')) {
        closeMobileNav();
      }
    });
    document.addEventListener('click', function (e) {
      if (!mobileNav.contains(e.target) && !navHamburger.contains(e.target)) {
        closeMobileNav();
      }
    });
    window.addEventListener('resize', function () {
      if (window.innerWidth > 900) closeMobileNav();
    });

    function smoothScrollToToolkit(focusSelector) {
      const container = document.getElementById('solar-toolkit');
      if (container) {
        const top = container.getBoundingClientRect().top + window.scrollY - 80;
        window.scrollTo({ top, behavior: 'smooth' });
        setTimeout(() => {
          if (focusSelector) document.querySelector(focusSelector)?.focus();
        }, 500);
      }
    }
    document.addEventListener("DOMContentLoaded", function () {
      document.getElementById('nav-orientation').addEventListener('click', function (e) {
        e.preventDefault();
        smoothScrollToToolkit('#addressInput');
      });
      document.getElementById('nav-calculator').addEventListener('click', function (e) {
        e.preventDefault();
        smoothScrollToToolkit('#rate');
      });
      document.getElementById('mnav-orientation').addEventListener('click', function (e) {
        e.preventDefault();
        closeMobileNav();
        setTimeout(() => smoothScrollToToolkit('#addressInput'), 100);
      });
      document.getElementById('mnav-calculator').addEventListener('click', function (e) {
        e.preventDefault();
        closeMobileNav();
        setTimeout(() => smoothScrollToToolkit('#rate'), 100);
      });
    });

    // --- The rest of your JavaScript (orientation, calculator, finance, chart, trust cards, etc.) ---
    // Orientation section logic (Street View only)
    let autocomplete, lastPlaceLocation = null, panoMap = null;

    function mapsApiLoaded() {
      if (typeof initMap === "function") initMap();
      if (typeof initQuoteAddressAutocomplete === "function") initQuoteAddressAutocomplete();
    }

    function initMap() {
      const input = document.getElementById("addressInput");
      autocomplete = new google.maps.places.Autocomplete(input, {
        componentRestrictions: { country: 'uk' },
        fields: ["geometry", "formatted_address", "address_components"],
        types: ["address"]
      });

      autocomplete.addListener("place_changed", () => {
        const place = autocomplete.getPlace();
        if (!place.geometry || !place.geometry.location) {
          alert("No details available for input: '" + place.name + "'");
          lastPlaceLocation = null;
          return;
        }
        lastPlaceLocation = place.geometry.location;
        // Orientation logic
        const viewport = place.geometry.viewport;
        let orientation = "Unknown";
        let explanation = "";
        orientationFactor = 0.9;

        if (viewport) {
          const ne = viewport.getNorthEast();
          const sw = viewport.getSouthWest();
          const angle = Math.atan2(ne.lat() - sw.lat(), ne.lng() - sw.lng()) * (180 / Math.PI);

          if (angle > -45 && angle <= 45) {
            orientation = "East";
            orientationFactor = 0.85;
            explanation = "Your front roof likely faces East and the rear West. A solar system can still work well with morning sunlight.";
          } else if (angle > 45 && angle <= 135) {
            orientation = "North";
            orientationFactor = 0.75;
            explanation = "Your front roof likely faces North and the rear South. South-facing roofs are ideal for solar.";
          } else if (angle > -135 && angle <= -45) {
            orientation = "South";
            orientationFactor = 1.0;
            explanation = "Your front roof likely faces South and the rear North. This is excellent for solar efficiency.";
          } else {
            orientation = "West";
            orientationFactor = 0.8;
            explanation = "Your front roof likely faces West and the rear East. Good for catching late afternoon sunlight.";
          }
        }

        document.getElementById("orientationResult").innerHTML =
          `<strong>Estimated Roof Orientation:</strong> ${orientation}<br><em>${explanation}</em>`;
      });
    }

    function initQuoteAddressAutocomplete() {
      var input = document.getElementById('quote-address');
      if (!input) return;
      var options = {
        componentRestrictions: { country: 'uk' },
        fields: ["formatted_address", "geometry"],
        types: ["address"]
      };
      var autocomplete = new google.maps.places.Autocomplete(input, options);
      autocomplete.setBounds(new google.maps.LatLngBounds(
        new google.maps.LatLng(49.9, -7.6),
        new google.maps.LatLng(58.7, 1.8)
      ));
    }

    function toggleStreetView() {
      const container = document.getElementById("streetview-container");
      const btn = document.getElementById("toggleMapBtn");
      if (container.style.display === 'none' || container.style.display === '') {
        if (!lastPlaceLocation) {
          alert("Please enter your address and select it from the dropdown first.");
          return;
        }
        container.style.display = "block";
        if (!panoMap) {
          panoMap = new google.maps.StreetViewPanorama(
            document.getElementById("pano"),
            {
              position: lastPlaceLocation,
              pov: { heading: 165, pitch: 0 },
              zoom: 1
            }
          );
        } else {
          panoMap.setPosition(lastPlaceLocation);
        }
        btn.innerText = "Hide Street View";
      } else {
        container.style.display = "none";
        btn.innerText = "Show Street View";
      }
    }

    // --- SOLAR CALCULATOR (UPDATED) ---
    let latestSavingsPerYear = 0;
    let latestAnnualSpend = 0;
    let latestSystemCost = 9500;

    // Only keep cost input in finance offset section
    function syncSystemCostFields(value) {
      document.getElementById('finance-system-cost').value = value;
    }

    document.addEventListener('DOMContentLoaded', function() {
      syncSystemCostFields('9500');
    });

    document.getElementById("calcForm").addEventListener("submit", function (e) {
      e.preventDefault();
      const rate = parseFloat(document.getElementById("rate").value);
      const standing = parseFloat(document.getElementById("standing").value);
      const usage = parseFloat(document.getElementById("usage").value);
      const batterySize = parseInt(document.getElementById("battery-size").value, 10); // 0, 5, 10
      const homeAllDay = document.getElementById("homeDay").checked;

      // Solar generation constants
      const systemSizeKW = 3.68;
      const panelSystemKW = 9 * 0.46;
      const kwhPerKWp = 1050;
      const estimatedAnnualGen = Math.min(systemSizeKW, panelSystemKW) * kwhPerKWp * orientationFactor;

      // Self-consumption ratios
      let baseSelfConsumption = homeAllDay ? 0.65 : 0.4;
      let batterySelfConsumption = 0;
      if (batterySize === 5) {
        batterySelfConsumption = homeAllDay ? 0.8 : 0.6;
      } else if (batterySize === 10) {
        batterySelfConsumption = homeAllDay ? 0.9 : 0.7;
      }
      const selfConsumptionRatio = batterySize === 0 ? baseSelfConsumption : batterySelfConsumption;

      // Calculate actual self-used and exported
      let selfUsedKWh = Math.min(usage, estimatedAnnualGen * selfConsumptionRatio);
      let exportKWh = Math.max(0, estimatedAnnualGen - selfUsedKWh);
      if (usage < estimatedAnnualGen * selfConsumptionRatio) {
        exportKWh = estimatedAnnualGen - usage;
        selfUsedKWh = usage;
      }

      // Bill and savings calculations
      const annualStanding = standing * 365 / 100;
      const billUsage = rate * usage / 100;
      const annualSpend = billUsage + annualStanding;
      latestAnnualSpend = annualSpend;

      // Yearly savings and export calculations
      let annualSavingsArr = [];
      let price = rate;
      let exportRate = 16.5;
      let cumulative = 0;
      let exportIncomeCumulative = 0;
      for (let year = 1; year <= 10; year++) {
        let yearSavings = (selfUsedKWh * price) / 100;
        let yearExportIncome = (exportKWh * exportRate) / 100;
        cumulative += yearSavings;
        exportIncomeCumulative += yearExportIncome;
        annualSavingsArr.push({
          year,
          price: price.toFixed(2),
          savings: yearSavings.toFixed(2),
          exportIncome: yearExportIncome.toFixed(2),
          cumulative: cumulative.toFixed(2),
          exportCumulative: exportIncomeCumulative.toFixed(2)
        });
        price *= 1.0704;
      }
      let tableRows = annualSavingsArr.map(row =>
        `<tr>
          <td>Year ${row.year}</td>
          <td>£${row.savings}</td>
          <td>£${row.exportIncome}</td>
          <td>${row.price}p/kWh</td>
          <td>£${row.cumulative}</td>
          <td>£${row.exportCumulative}</td>
        </tr>`
      ).join('');
      const presenceText = homeAllDay
        ? "You're home during the day"
        : "You're out during the day";
      const batteryDesc = batterySize > 0 ? ` with ${batterySize}kWh battery` : "";
      const calcResult = document.getElementById("calcResult");
      latestSavingsPerYear = parseFloat(annualSavingsArr[0].savings);

      calcResult.innerHTML = `
        <div style="margin-bottom:1.1em;">
          <h3>Estimated Annual Savings (Year 1): £${annualSavingsArr[0].savings}</h3>
          <p>Your system is estimated to generate <strong>${estimatedAnnualGen.toFixed(0)} kWh</strong> per year.</p>
          <p>Annual self-used solar: <strong>${selfUsedKWh.toFixed(0)} kWh</strong> (${(100*selfUsedKWh/usage).toFixed(0)}% of your usage${batteryDesc}, ${presenceText})</p>
          <p>Annual solar export: <strong>${exportKWh.toFixed(0)} kWh</strong>
            <br>Value of exported energy at 16.5p/kWh: <strong>£${((exportKWh*exportRate)/100).toFixed(2)}</strong>
          </p>
          <p><b>Your annual energy spend (inc. standing charge): £${annualSpend.toFixed(2)}</b></p>
        </div>
        <h4>Projected Savings and Export Over 10 Years (with 7.04% price increase per year):</h4>
        <table style="margin:auto;border-collapse:collapse;">
          <tr>
            <th>Year</th>
            <th>Bill Savings</th>
            <th>Export Income</th>
            <th>Price per kWh</th>
            <th>Cumulative Savings</th>
            <th>Cumulative Export</th>
          </tr>
          ${tableRows}
        </table>
        <p style="font-size:0.95em;color:#888;">This calculation is based on a system with 9 solar panels – if your roof can fit more, your potential savings will be even higher. These are estimated figures based on typical UK conditions. For a free comprehensive breakdown, fill in the free quote form.</p>
      `;

      showFinanceOffset();
    });

    function showFinanceOffset() {
      const section = document.getElementById("finance-offset-section");
      section.style.display = "block";
      updateFinanceOffset();
    }

    function updateFinanceOffset() {
      const systemCostInput = document.getElementById("finance-system-cost");
      const depositInput = document.getElementById("deposit-amount");
      const installCost = parseFloat(systemCostInput?.value) || latestSystemCost || 9500;
      const deposit = parseFloat(depositInput?.value) || 0;
        <script>
    // --- Hamburger/mobile nav and smooth scroll logic ---
    let lastScroll = 0;
    const nav = document.getElementById("navbar");

    window.addEventListener("scroll", () => {
      const currentScroll = window.pageYOffset;
      nav.classList.toggle("hidden", currentScroll > lastScroll);
      lastScroll = currentScroll;
    });

    // Mobile Hamburger Dropdown & Smooth Scroll Logic
    const navHamburger = document.getElementById('nav-hamburger');
    const mobileNav = document.getElementById('mobile-nav');
    function closeMobileNav() {
      navHamburger.setAttribute('aria-expanded', 'false');
      mobileNav.classList.remove('open');
      document.body.style.overflow = '';
    }
    navHamburger.addEventListener('click', function (e) {
      const expanded = navHamburger.getAttribute('aria-expanded') === "true";
      navHamburger.setAttribute('aria-expanded', expanded ? "false" : "true");
      mobileNav.classList.toggle("open", !expanded);
      document.body.style.overflow = !expanded ? 'hidden' : '';
      if (!expanded) {
        setTimeout(() => mobileNav.querySelector('a')?.focus(), 200);
      }
    });
    mobileNav.addEventListener('click', function (e) {
      if (e.target.classList.contains('mobile-nav-link')) {
        closeMobileNav();
      }
    });
    document.addEventListener('click', function (e) {
      if (!mobileNav.contains(e.target) && !navHamburger.contains(e.target)) {
        closeMobileNav();
      }
    });
    window.addEventListener('resize', function () {
      if (window.innerWidth > 900) closeMobileNav();
    });

    function smoothScrollToToolkit(focusSelector) {
      const container = document.getElementById('solar-toolkit');
      if (container) {
        const top = container.getBoundingClientRect().top + window.scrollY - 80;
        window.scrollTo({ top, behavior: 'smooth' });
        setTimeout(() => {
          if (focusSelector) document.querySelector(focusSelector)?.focus();
        }, 500);
      }
    }
    document.addEventListener("DOMContentLoaded", function () {
      // Desktop nav
      document.getElementById('nav-orientation').addEventListener('click', function (e) {
        e.preventDefault();
        smoothScrollToToolkit('#addressInput');
      });
      document.getElementById('nav-calculator').addEventListener('click', function (e) {
        e.preventDefault();
        smoothScrollToToolkit('#rate');
      });
      // Mobile nav
      document.getElementById('mnav-orientation').addEventListener('click', function (e) {
        e.preventDefault();
        closeMobileNav();
        setTimeout(() => smoothScrollToToolkit('#addressInput'), 100);
      });
      document.getElementById('mnav-calculator').addEventListener('click', function (e) {
        e.preventDefault();
        closeMobileNav();
        setTimeout(() => smoothScrollToToolkit('#rate'), 100);
      });
    });

    // --- The rest of your JS is unchanged below (maps, calculator, finance, chart, trust cards, etc.) ---

    let orientationFactor = 1;

    // Orientation section logic (Street View only)
    let autocomplete, lastPlaceLocation = null, panoMap = null;

    function mapsApiLoaded() {
      if (typeof initMap === "function") initMap();
      if (typeof initQuoteAddressAutocomplete === "function") initQuoteAddressAutocomplete();
    }

    function initMap() {
      const input = document.getElementById("addressInput");
      autocomplete = new google.maps.places.Autocomplete(input, {
        componentRestrictions: { country: 'uk' },
        fields: ["geometry", "formatted_address", "address_components"],
        types: ["address"]
      });

      autocomplete.addListener("place_changed", () => {
        const place = autocomplete.getPlace();
        if (!place.geometry || !place.geometry.location) {
          alert("No details available for input: '" + place.name + "'");
          lastPlaceLocation = null;
          return;
        }
        lastPlaceLocation = place.geometry.location;
        // Orientation logic
        const viewport = place.geometry.viewport;
        let orientation = "Unknown";
        let explanation = "";
        orientationFactor = 0.9;

        if (viewport) {
          const ne = viewport.getNorthEast();
          const sw = viewport.getSouthWest();
          const angle = Math.atan2(ne.lat() - sw.lat(), ne.lng() - sw.lng()) * (180 / Math.PI);

          if (angle > -45 && angle <= 45) {
            orientation = "East";
            orientationFactor = 0.85;
            explanation = "Your front roof likely faces East and the rear West. A solar system can still work well with morning sunlight.";
          } else if (angle > 45 && angle <= 135) {
            orientation = "North";
            orientationFactor = 0.75;
            explanation = "Your front roof likely faces North and the rear South. South-facing roofs are ideal for solar.";
          } else if (angle > -135 && angle <= -45) {
            orientation = "South";
            orientationFactor = 1.0;
            explanation = "Your front roof likely faces South and the rear North. This is excellent for solar efficiency.";
          } else {
            orientation = "West";
            orientationFactor = 0.8;
            explanation = "Your front roof likely faces West and the rear East. Good for catching late afternoon sunlight.";
          }
        }

        document.getElementById("orientationResult").innerHTML =
          `<strong>Estimated Roof Orientation:</strong> ${orientation}<br><em>${explanation}</em>`;
      });
    }

    function initQuoteAddressAutocomplete() {
      var input = document.getElementById('quote-address');
      if (!input) return;
      var options = {
        componentRestrictions: { country: 'uk' },
        fields: ["formatted_address", "geometry"],
        types: ["address"]
      };
      var autocomplete = new google.maps.places.Autocomplete(input, options);
      autocomplete.setBounds(new google.maps.LatLngBounds(
        new google.maps.LatLng(49.9, -7.6),
        new google.maps.LatLng(58.7, 1.8)
      ));
    }

    function toggleStreetView() {
      const container = document.getElementById("streetview-container");
      const btn = document.getElementById("toggleMapBtn");
      if (container.style.display === 'none' || container.style.display === '') {
        if (!lastPlaceLocation) {
          alert("Please enter your address and select it from the dropdown first.");
          return;
        }
        container.style.display = "block";
        if (!panoMap) {
          panoMap = new google.maps.StreetViewPanorama(
            document.getElementById("pano"),
            {
              position: lastPlaceLocation,
              pov: { heading: 165, pitch: 0 },
              zoom: 1
            }
          );
        } else {
          panoMap.setPosition(lastPlaceLocation);
        }
        btn.innerText = "Hide Street View";
      } else {
        container.style.display = "none";
        btn.innerText = "Show Street View";
      }
    }

    // --- SOLAR CALCULATOR (UPDATED) ---
    let latestSavingsPerYear = 0;
    let latestAnnualSpend = 0;
    let latestSystemCost = 9500;

    // Only keep cost input in finance offset section
    function syncSystemCostFields(value) {
      document.getElementById('finance-system-cost').value = value;
    }

    document.addEventListener('DOMContentLoaded', function() {
      syncSystemCostFields('9500');
    });

    document.getElementById("calcForm").addEventListener("submit", function (e) {
      e.preventDefault();
      const rate = parseFloat(document.getElementById("rate").value);
      const standing = parseFloat(document.getElementById("standing").value);
      const usage = parseFloat(document.getElementById("usage").value);
      const batterySize = parseInt(document.getElementById("battery-size").value, 10); // 0, 5, 10
      const homeAllDay = document.getElementById("homeDay").checked;

      // Solar generation constants
      const systemSizeKW = 3.68;
      const panelSystemKW = 9 * 0.46;
      const kwhPerKWp = 1050;
      const estimatedAnnualGen = Math.min(systemSizeKW, panelSystemKW) * kwhPerKWp * orientationFactor;

      // Self-consumption ratios
      let baseSelfConsumption = homeAllDay ? 0.65 : 0.4;
      let batterySelfConsumption = 0;
      if (batterySize === 5) {
        batterySelfConsumption = homeAllDay ? 0.8 : 0.6;
      } else if (batterySize === 10) {
        batterySelfConsumption = homeAllDay ? 0.9 : 0.7;
      }
      const selfConsumptionRatio = batterySize === 0 ? baseSelfConsumption : batterySelfConsumption;

      // Calculate actual self-used and exported
      let selfUsedKWh = Math.min(usage, estimatedAnnualGen * selfConsumptionRatio);
      let exportKWh = Math.max(0, estimatedAnnualGen - selfUsedKWh);
      if (usage < estimatedAnnualGen * selfConsumptionRatio) {
        exportKWh = estimatedAnnualGen - usage;
        selfUsedKWh = usage;
      }

      // Bill and savings calculations
      const annualStanding = standing * 365 / 100;
      const billUsage = rate * usage / 100;
      const annualSpend = billUsage + annualStanding;
      latestAnnualSpend = annualSpend;

      // Yearly savings and export calculations
      let annualSavingsArr = [];
      let price = rate;
      let exportRate = 16.5;
      let cumulative = 0;
      let exportIncomeCumulative = 0;
      for (let year = 1; year <= 10; year++) {
        let yearSavings = (selfUsedKWh * price) / 100;
        let yearExportIncome = (exportKWh * exportRate) / 100;
        cumulative += yearSavings;
        exportIncomeCumulative += yearExportIncome;
        annualSavingsArr.push({
          year,
          price: price.toFixed(2),
          savings: yearSavings.toFixed(2),
          exportIncome: yearExportIncome.toFixed(2),
          cumulative: cumulative.toFixed(2),
          exportCumulative: exportIncomeCumulative.toFixed(2)
        });
        price *= 1.0704;
      }
      let tableRows = annualSavingsArr.map(row =>
        `<tr>
          <td>Year ${row.year}</td>
          <td>£${row.savings}</td>
          <td>£${row.exportIncome}</td>
          <td>${row.price}p/kWh</td>
          <td>£${row.cumulative}</td>
          <td>£${row.exportCumulative}</td>
        </tr>`
      ).join('');
      const presenceText = homeAllDay
        ? "You're home during the day"
        : "You're out during the day";
      const batteryDesc = batterySize > 0 ? ` with ${batterySize}kWh battery` : "";
      const calcResult = document.getElementById("calcResult");
      latestSavingsPerYear = parseFloat(annualSavingsArr[0].savings);

      calcResult.innerHTML = `
        <div style="margin-bottom:1.1em;">
          <h3>Estimated Annual Savings (Year 1): £${annualSavingsArr[0].savings}</h3>
          <p>Your system is estimated to generate <strong>${estimatedAnnualGen.toFixed(0)} kWh</strong> per year.</p>
          <p>Annual self-used solar: <strong>${selfUsedKWh.toFixed(0)} kWh</strong> (${(100*selfUsedKWh/usage).toFixed(0)}% of your usage${batteryDesc}, ${presenceText})</p>
          <p>Annual solar export: <strong>${exportKWh.toFixed(0)} kWh</strong>
            <br>Value of exported energy at 16.5p/kWh: <strong>£${((exportKWh*exportRate)/100).toFixed(2)}</strong>
          </p>
          <p><b>Your annual energy spend (inc. standing charge): £${annualSpend.toFixed(2)}</b></p>
        </div>
        <h4>Projected Savings and Export Over 10 Years (with 7.04% price increase per year):</h4>
        <table style="margin:auto;border-collapse:collapse;">
          <tr>
            <th>Year</th>
            <th>Bill Savings</th>
            <th>Export Income</th>
            <th>Price per kWh</th>
            <th>Cumulative Savings</th>
            <th>Cumulative Export</th>
          </tr>
          ${tableRows}
        </table>
        <p style="font-size:0.95em;color:#888;">This calculation is based on a system with 9 solar panels – if your roof can fit more, your potential savings will be even higher. These are estimated figures based on typical UK conditions. For a free comprehensive breakdown, fill in the free quote form.</p>
      `;

      showFinanceOffset();
    });

    function showFinanceOffset() {
      const section = document.getElementById("finance-offset-section");
      section.style.display = "block";
      updateFinanceOffset();
    }

    function updateFinanceOffset() {
      const systemCostInput = document.getElementById("finance-system-cost");
      const depositInput = document.getElementById("deposit-amount");
      const installCost = parseFloat(systemCostInput?.value) || latestSystemCost || 9500;
      const deposit = parseFloat(depositInput?.value) || 0;
      if (deposit > installCost) {
        depositInput.value = installCost;
      }
      const loanAmount = installCost - deposit;
      const years = 10;
      const n = years * 12;
      const rate = 0.099;
      const monthlyRate = rate / 12;
      let monthly = (loanAmount * monthlyRate) / (1 - Math.pow(1 + monthlyRate, -n));
      const totalFinance = (monthly * n) + deposit;

      const savingsPerYear = latestSavingsPerYear || 800;
      const savingsPerMonth = savingsPerYear / 12;
      const totalSavings10y = savingsPerYear * years;
      const annualSpend = latestAnnualSpend || 1200;
      const totalElec10y = annualSpend * years;

      const netMonthly = monthly - savingsPerMonth;
      const net10y = (monthly * n) - totalSavings10y + deposit;
      const diff = totalElec10y - net10y;

      const summary = `
        <p>
          <b>Typical system cost:</b> £${installCost.toLocaleString()}
          &nbsp; <b>Deposit:</b> £${deposit.toLocaleString()}<br>
          <b>Monthly finance payment:</b> £${monthly.toFixed(2)}<br>
          <b>Estimated average monthly savings:</b> £${savingsPerMonth.toFixed(2)}
        </p>
        <p>
          <b>Net outgoing (finance payment minus savings):</b> <span>${netMonthly > 0 ? "£"+netMonthly.toFixed(2)+"/month" : "<span class='diff-positive'>£"+netMonthly.toFixed(2)+"/month</span>"}</span>
        </p>
        <hr>
        <p>
          <b>Total cost with solar & finance over 10 years:</b> £${net10y.toFixed(2)}<br>
          <b>Total paid for electricity (no solar) over 10 years:</b> £${totalElec10y.toFixed(2)}<br>
          <b>Difference:</b> <span class="${diff > 0 ? 'diff-positive' : 'diff-negative'}">${diff > 0 ? "You save £"+diff.toFixed(2) : "Solar+finance costs £"+Math.abs(diff).toFixed(2)+" more"}</span>
        </p>
      `;
      document.getElementById("finance-offset-summary").innerHTML = summary;
    }

    document.getElementById("depositForm").addEventListener("submit", function(e){
      e.preventDefault();
      updateFinanceOffset();
    });

    document.getElementById('finance-system-cost').addEventListener('input', function(e) {
      syncSystemCostFields(e.target.value);
    });

    function toggleHistoric() {
      let g = document.getElementById('historic-graph');
      g.style.display = (g.style.display === 'none' || g.style.display === '') ? 'block' : 'none';
      if (g.style.display === 'block' && !window._historicChartLoaded) {
        drawPriceChart();
        window._historicChartLoaded = true;
      }
    }
    function drawPriceChart() {
      const ctx = document.getElementById('pricesChart').getContext('2d');
      const years = [
        2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,
        2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,
        2020,2021,2022,2023,2024,2025
      ];
      const prices = [
        7.0,7.3,7.2,7.1,7.4,8.2,10.0,10.6,13.3,13.9,
        13.7,14.5,15.5,15.6,15.6,15.2,14.4,14.4,15.0,17.2,
        17.2,19.0,28.0,30.0,28.5,27.5
      ];
      new Chart(ctx, {
        type: 'line',
        data: {
          labels: years,
          datasets: [{
            label: 'UK Domestic Electricity Price (p/kWh)',
            data: prices,
            borderColor: '#397a94',
            backgroundColor: 'rgba(57,122,148,0.13)',
            tension: 0.25,
            pointBackgroundColor: '#ffd700',
            pointRadius: 5,
            fill: true
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { display: true },
            tooltip: { enabled: true }
          },
          scales: {
            y: {
              beginAtZero: true,
              title: { display: true, text: 'pence per kWh' }
            },
            x: {
              title: { display: true, text: 'Year' }
            }
          }
        }
      });
    }

    // Trust card open/close logic
    document.querySelectorAll('.accredit-card-btn').forEach(btn => {
      btn.addEventListener('click', function() {
        document.querySelectorAll('.accredit-card').forEach(card => {
          if (card.contains(btn)) {
            card.classList.toggle('active');
            btn.setAttribute('aria-expanded', card.classList.contains('active'));
          } else {
            card.classList.remove('active');
            card.querySelector('.accredit-card-btn').setAttribute('aria-expanded', 'false');
          }
        });
      });
      btn.addEventListener('keydown', function(e) {
        if (e.key === "Enter" || e.key === " " || e.key === "Spacebar") {
          e.preventDefault();
          btn.click();
        }
      });
    });
  </script>
</body>
</html>
