<!DOCTYPE html>
<html lang="en">
<head>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC0y8SNlXSgKW0aHxXofroM4_aPqzaIrFQ&libraries=places&callback=mapsApiLoaded" async defer></script>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Let’s Talk About Solar</title>
  <meta name="description" content="Clear, friendly, and honest solar advice for UK homeowners. Discover real savings, trusted installers, and smart solar tools." />
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --green: #11998e;
      --green-dark: #064e3b;
      --green-light: #38ef7d;
      --blue: #1866e6;
      --blue-dark: #1c2e4a;
      --blue-light: #b3d8fd;
      --accent: #fffbe7;
      --text: #132c1d;
      --bg: #f5fcfa;
      --card: #fff;
      --radius: 20px;
      --shadow: 0 6px 32px rgba(24,102,230,0.09), 0 1.5px 0 0 #11998e10;
    }
    html, body {
      margin: 0;
      padding: 0;
      background: var(--bg);
      font-family: 'Nunito', Arial, sans-serif;
      color: var(--text);
      min-height: 100vh;
    }
    nav {
      background: linear-gradient(90deg, var(--green) 0%, var(--blue) 100%);
      color: #fff;
      box-shadow: var(--shadow);
      padding: 0.7rem 0;
      position: sticky;
      top: 0;
      z-index: 1000;
      display: flex;
      justify-content: center;
      align-items: center;
      border-bottom-left-radius: var(--radius);
      border-bottom-right-radius: var(--radius);
      font-size: 1.08rem;
    }
    .nav-inner {
      display: flex;
      justify-content: space-between;
      align-items: center;
      width: 100%;
      max-width: 1200px;
      padding: 0 1.5rem;
    }
    .logo {
      font-size: 1.45rem;
      font-weight: bold;
      color: #fff;
      letter-spacing: 1px;
      margin-right: 2rem;
      text-shadow: 0 2px 12px #11998e33;
    }
    nav ul {
      list-style: none;
      display: flex;
      gap: 1.1rem;
      margin: 0;
      padding: 0;
      align-items: center;
    }
    nav ul li a {
      text-decoration: none;
      color: #eafef7;
      font-weight: 600;
      padding: 0.4em 1.1em;
      border-radius: 99px;
      transition: background 0.15s, color 0.15s;
      background: none;
      font-size: 1.02em;
    }
    nav ul li a.cta-nav {
      background: var(--accent);
      color: var(--green-dark);
      box-shadow: 0 2px 8px #38ef7d22;
    }
    nav ul li a:hover,
    nav ul li a.cta-nav:hover {
      background: var(--green-light);
      color: var(--blue-dark);
    }
    @media (max-width: 800px) {
      .nav-inner {
        flex-direction: column;
        gap: 0.7em;
      }
      nav ul {
        gap: 0.5rem;
        flex-wrap: wrap;
      }
    }
    header.hero {
      background: linear-gradient(90deg, var(--green) 0%, var(--blue) 100%);
      color: #fff;
      padding: 3.3rem 1.5rem 2.3rem 1.5rem;
      text-align: center;
      border-bottom-left-radius: var(--radius);
      border-bottom-right-radius: var(--radius);
      box-shadow: 0 6px 32px #11998e22;
      margin-bottom: 1rem;
    }
    header.hero h1 {
      font-size: 2.7rem;
      font-weight: 700;
      margin: 0 0 1.2rem 0;
      letter-spacing: .5px;
      text-shadow: 0 2px 10px #11998e30;
    }
    header.hero p {
      font-size: 1.35rem;
      margin: 1.2rem auto 2.2rem auto;
      max-width: 500px;
      color: #e0f7ee;
    }
    .cta-main {
      background: linear-gradient(90deg, var(--green-light) 0%, var(--blue-light) 100%);
      color: var(--green-dark);
      padding: 1rem 2.5rem;
      border-radius: 999px;
      font-size: 1.2rem;
      font-weight: bold;
      text-decoration: none;
      border: none;
      cursor: pointer;
      box-shadow: 0 2px 16px #11998e33;
      margin-top: 1.2rem;
      transition: background .16s, color .16s;
      display:inline-block;
    }
    .cta-main:hover {
      background: linear-gradient(90deg, var(--blue) 0%, var(--green-light) 100%);
      color: #fff;
    }
    .section {
      max-width: 1200px;
      margin: 2.5rem auto;
      padding: 1.6rem 1.2rem 1.8rem 1.2rem;
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
    }
    /* Benefits Section */
    .benefit-cards {
      display: flex;
      flex-wrap: wrap;
      gap: 2rem;
      justify-content: center;
      margin-top: 2rem;
    }
    .benefit-card {
      background: linear-gradient(120deg, #eafef7 70%, #b3d8fd 100%);
      padding: 1.3rem 1.1rem 1.1rem 1.1rem;
      border-radius: var(--radius);
      box-shadow: 0 2px 10px #11998e15;
      min-width: 165px;
      max-width: 220px;
      display: flex;
      flex-direction: column;
      align-items: center;
      border: 1.2px solid #38ef7d60;
      transition: box-shadow .15s, border .15s;
      margin-bottom: 0.8em;
    }
    .benefit-card:hover {
      box-shadow: 0 8px 32px 0 #38ef7d44;
      border-color: var(--blue);
      transform: translateY(-4px) scale(1.03);
    }
    .benefit-card img {
      width: 48px;
      height: 48px;
      object-fit: contain;
      margin-bottom: 0.8rem;
      filter: drop-shadow(0 1px 8px #38ef7d33);
    }
    .benefit-card p {
      color: var(--green-dark);
      font-size: 1.09rem;
      margin: 0;
      text-align: center;
      font-weight: 500;
    }
    /* Toolkit and Calculator */
    .toolkit {
      display: flex;
      gap: 2.5rem;
      flex-wrap: wrap;
      align-items: flex-start;
      justify-content: center;
      margin-top:2.5em;
      margin-bottom:1em;
    }
    .toolkit > div {
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 2rem 1.6rem 2rem 1.6rem;
      min-width: 300px;
      max-width: 430px;
      flex: 1 1 320px;
      margin-bottom: 2rem;
    }
    .toolkit h2 {
      color: var(--blue);
      font-size: 1.35rem;
      margin-top:0;
      margin-bottom:.7em;
      letter-spacing: .2px;
    }
    /* Calculator UI */
    .calculator-form label {
      display: block;
      margin-bottom: 0.5em;
      margin-top: 1.1em;
      font-weight: 600;
      color: var(--blue-dark);
    }
    .calculator-form input[type="number"], 
    .calculator-form input[type="text"] {
      width: 100%;
      padding: 0.6em;
      border: 1.2px solid var(--blue-light);
      border-radius: 7px;
      font-size: 1.05em;
      background: #f4fafd;
      color: #17384a;
      margin-bottom: 0.2em;
      transition: border .15s;
    }
    .calculator-form input[type="number"]:focus,
    .calculator-form input[type="text"]:focus {
      border: 1.4px solid var(--green);
      outline: none;
      background: #e9fef6;
    }
    .calc-radio-group {
      display: flex;
      gap: 1.2em;
      margin: 1.3em 0 0.5em 0;
      align-items: center;
      justify-content: flex-start;
    }
    .calc-radio-group label {
      font-weight: 600;
      color: var(--green-dark);
      margin-top:0;
      margin-bottom:0;
      display: flex;
      align-items: center;
      gap: 0.3em;
      cursor: pointer;
    }
    .calculator-form input[type="radio"] {
      accent-color: var(--green);
      margin-right: .3em;
    }
    .calculator-form input[type="checkbox"] {
      accent-color: var(--blue);
      margin-right: .5em;
    }
    .calculator-form button {
      background: linear-gradient(90deg, var(--blue-light) 0%, var(--green-light) 100%);
      color: var(--green-dark);
      padding: 0.8rem 2.6rem;
      border: none;
      border-radius: 999px;
      cursor: pointer;
      font-weight: 700;
      font-size: 1.15rem;
      margin-top: 1.2em;
      box-shadow: 0 2px 14px #11998e22;
      letter-spacing: .1px;
      transition: background .16s, color .16s;
    }
    .calculator-form button:hover {
      background: linear-gradient(90deg, var(--green-light) 0%, var(--blue) 100%);
      color: #fff;
    }
    #calcResult {
      margin-top: 1.2em;
      background: #eafef7;
      border-radius: 12px;
      padding: 1.1em 1em;
      color: var(--green-dark);
      font-size: 1.11em;
      box-shadow: 0 1px 7px #11998e15;
    }
    /* Trust Section */
    .trust-cards {
      display: flex;
      flex-wrap: wrap;
      gap: 2rem 1.5rem;
      justify-content: center;
      align-items: stretch;
      margin: 1.5rem auto 0 auto;
      max-width: 900px;
    }
    .accredit-card {
      background: linear-gradient(130deg, #e6fdf6 60%, #b3d8fd 100%);
      box-shadow: 0 4px 16px #38ef7d33;
      border-radius: 15px;
      border: 1.2px solid #38ef7d80;
      padding: 1.2em 1em 0.8em 1em;
      min-width: 130px;
      max-width: 210px;
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-bottom: 1.5em;
      position: relative;
      transition: box-shadow .15s, border .15s;
      cursor: pointer;
    }
    .accredit-card:focus-within, .accredit-card:hover {
      box-shadow: 0 8px 34px #1866e677;
      border-color: var(--blue);
      transform: translateY(-4px) scale(1.04);
      z-index: 2;
    }
    .accredit-card-btn {
      background: none;
      border: none;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      align-items: center;
      font: inherit;
      outline: none;
      transition: transform .13s;
    }
    .accredit-card-btn:focus {
      outline: 2.5px solid var(--blue);
      outline-offset: 3px;
    }
    .accredit-card img {
      width: 50px;
      height: 50px;
      object-fit: contain;
      background: #f5fcfa;
      border-radius: 11px;
      box-shadow: 0 2px 9px #38ef7d44;
      margin-bottom: 0.7em;
      border: 1.5px solid #38ef7d;
      padding: 6px;
      transition: border .13s;
    }
    .accredit-card:hover img, .accredit-card:focus-within img {
      border-color: var(--blue);
    }
    .accredit-card span {
      font-weight: 700;
      color: var(--green-dark);
      font-size: 1.1em;
      letter-spacing: .6px;
      margin-bottom: .2em;
    }
    .accredit-card-desc {
      display: none;
      margin-top: 0.7em;
      background: #f4fafd;
      color: var(--blue-dark);
      border-radius: 11px;
      box-shadow: 0 2px 12px #38ef7d33;
      padding: 0.82em 0.8em 1.1em 0.8em;
      font-size: 1em;
      text-align: left;
      max-width: 270px;
      min-height: 64px;
      border: 1.2px solid #b3d8fd;
      position: absolute;
      top: 100%;
      left: 50%;
      transform: translate(-50%, .5em);
      z-index: 3;
      animation: fadeIn .32s;
    }
    .accredit-card.active .accredit-card-desc,
    .accredit-card:focus-within .accredit-card-desc {
      display: block;
    }
    /* Facebook Feed Section */
    .facebook-feed-section {
      max-width: 700px;
      margin: 3rem auto;
      padding: 2.3rem 1rem;
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      text-align: center;
      border: 1.5px solid #b3d8fd;
      backdrop-filter: blur(8px);
    }
    #fb-feed {
      margin-top: 1.2em;
      text-align: left;
    }
    .fb-post {
      background: #eafef7;
      border-radius: 14px;
      box-shadow: 0 2px 14px #38ef7d33;
      margin-bottom: 2rem;
      padding: 1.3rem;
      border: 1.2px solid #b3d8fd;
    }
    .fb-date {
      color: #1866e6;
      font-size: 0.98em;
      margin-bottom: 0.6em;
    }
    .fb-message {
      font-size: 1.11em;
      margin-bottom: 0.7em;
      color: #11998e;
    }
    .fb-link {
      color: var(--green);
      text-decoration: underline;
      font-size: 0.97em;
      font-weight: bold;
    }
    footer {
      background: linear-gradient(90deg, #1866e6 0%, #11998e 100%);
      color: #eafef7;
      padding: 2.2rem;
      text-align: center;
      margin-top: 3rem;
      border-radius: var(--radius) var(--radius) 0 0;
      font-size: 1.01rem;
      letter-spacing: 0.2px;
      box-shadow: 0 -2px 22px #38ef7d22;
    }
    @media (max-width: 900px) {
      .container, .toolkit {
        flex-direction: column;
        align-items: center;
      }
      .section, .card, .toolkit > div {
        max-width: 97vw;
      }
      .trust-cards {
        flex-direction: column;
        align-items: center;
        gap: 1.3rem;
      }
      .accredit-card {
        max-width: 95vw;
        min-width: 160px;
      }
      .accredit-card-desc {
        position: static;
        transform: none;
        margin-top: .7em;
        width: 99%;
        max-width: 99vw;
      }
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translate(-50%, 1.5em);}
      to { opacity: 1; transform: translate(-50%, .5em);}
    }
  </style>
</head>
<body>
  <nav>
    <div class="nav-inner">
      <div class="logo">Let’s Talk About Solar</div>
      <ul>
        <li><a href="#hero">Home</a></li>
        <li><a href="#benefits">Why Solar?</a></li>
        <li><a href="#orientation-card">Orientation</a></li>
        <li><a href="#calculator">Savings</a></li>
        <li><a href="#trust">Trust</a></li>
        <li><a href="#facebook-feed" class="cta-nav">FB Feed</a></li>
        <li><a href="#quote" class="cta-nav">Get Quote</a></li>
      </ul>
    </div>
  </nav>

  <header class="hero" id="hero">
    <h1>Sunshine Meets Smart Savings</h1>
    <p>See how solar can protect your bills and power your future.</p>
    <a href="#quote" class="cta-main">Get My Free Quote</a>
  </header>

  <section id="benefits" class="section">
    <h2 style="color:var(--green);font-size:2rem;">Why Solar?</h2>
    <div class="benefit-cards">
      <div class="benefit-card">
        <img src="https://cdn-icons-png.flaticon.com/512/3135/3135715.png" alt="Money saving GBP icon">
        <p>Save money on your bills from day one.</p>
      </div>
      <div class="benefit-card">
        <img src="https://cdn-icons-png.flaticon.com/512/3103/3103446.png" alt="Battery storage icon">
        <p>Store your sunshine with battery technology.</p>
      </div>
      <div class="benefit-card">
        <img src="https://cdn-icons-png.flaticon.com/512/2422/2422625.png" alt="Pylon selling to grid icon">
        <p>Sell your surplus energy back to the grid.</p>
      </div>
    </div>
  </section>

  <div class="toolkit" id="solar-toolkit">
    <div>
      <h2>Check Your Roof Orientation</h2>
      <input id="addressInput" type="text" placeholder="Enter your address" style="max-width:320px;margin:0 auto 1.2rem auto;display:block;" />
      <button id="toggleMapBtn" onclick="toggleStreetView()" style="margin:0.7rem 0 1.1rem 0;padding:0.7rem 1.3rem;border-radius:999px;background:var(--green);color:#fff;font-weight:bold;font-size:1rem;border:none;box-shadow:0 2px 8px #11998e40;cursor:pointer;">
        Show Street View
      </button>
      <div id="streetview-container" style="width:100%;max-width:340px;height:145px;display:none;border-radius:13px;overflow:hidden;margin:0 auto 1rem auto;background:#b3d8fd;">
        <div id="pano" style="width:100%;height:100%;"></div>
      </div>
      <p id="orientationResult" style="margin-top: 0.8rem; font-weight: bold;color:var(--blue);text-align:center;"></p>
    </div>

    <div id="calculator">
      <h2>Solar Savings Calculator</h2>
      <form id="calcForm" class="calculator-form">
        <label for="rate">Electricity unit rate (p/kWh):</label>
        <input type="number" id="rate" placeholder="e.g. 25" required>
        <label for="standing">Standing charge (p/day):</label>
        <input type="number" id="standing" placeholder="e.g. 60" required>
        <label for="usage">Annual electricity usage (kWh):</label>
        <input type="number" id="usage" placeholder="e.g. 4000" required>
        <label style="margin-top:1.2em;">
          <input type="checkbox" id="battery"> Include battery?
        </label>
        <div class="calc-radio-group">
          <label>
            <input type="radio" name="dayPresence" id="homeDay" value="home" checked>
            <span>I'm home during the day</span>
          </label>
          <label>
            <input type="radio" name="dayPresence" id="outDay" value="out">
            <span>I'm out during the day</span>
          </label>
        </div>
        <button type="submit">Calculate My Savings</button>
      </form>
      <div id="calcResult"></div>
    </div>
  </div>

  <!-- Finance Offset Section -->
  <section id="finance-offset-section" class="section" style="display:none;">
    <h2 style="text-align:center;">Finance & Bill Offset Illustration</h2>
    <form id="depositForm" class="inline-form" autocomplete="off" style="text-align:center;margin-bottom:1.2em;">
      <label for="deposit-amount">Deposit (£):</label>
      <input type="number" id="deposit-amount" value="0" min="0" max="9500" step="100">
      <button type="submit" style="background:var(--green);color:#fffbe7;padding:0.4em 1.3em;border-radius:999px;border:none;cursor:pointer;">Recalculate</button>
    </form>
    <div id="finance-offset-summary" class="finance-summary"></div>
    <div class="disclaimer" style="color:#1c2e4a;">
      <strong>Disclaimer:</strong> This illustration uses typical finance terms and current savings estimates for guidance only.
      Actual bills, savings, and finance rates may vary. Please consult a financial adviser for tailored advice.
    </div>
  </section>

  <section id="historic-prices" class="section">
    <button onclick="toggleHistoric()" style="font-size:1.1rem;padding:0.5rem 1.5rem;background:var(--blue);color:#fffbe7;border:none;border-radius:20px;cursor:pointer;">
      Show Historic Electricity Prices (2000-2025)
    </button>
    <div id="historic-graph" style="display:none;margin-top:2rem;">
      <canvas id="pricesChart" width="400" height="200"></canvas>
      <p style="font-size:0.9rem;color:gray;">
        Sources: 
        <a href="https://www.gov.uk/government/statistical-data-sets/annual-domestic-energy-price-statistics" target="_blank">UK Government</a>, 
        <a href="https://www.ons.gov.uk/economy/inflationandpriceindices/datasets/consumerpriceindices" target="_blank">Office for National Statistics (ONS)</a>, 
        <a href="https://www.ofgem.gov.uk/energy-data-and-research/data-portal/retail-market-indicators" target="_blank">Ofgem</a>
      </p>
    </div>
  </section>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  
  <section id="trust" class="section">
    <h2 style="color:var(--green);font-size:2rem;">Who Can You Trust?</h2>
    <div class="trust-cards">
      <div class="accredit-card" tabindex="0">
        <button class="accredit-card-btn" type="button" aria-expanded="false">
          <img src="assets/mcs logo.png" alt="MCS Certified" />
          <span>MCS</span>
        </button>
        <div class="accredit-card-desc">
          <strong>MCS (Microgeneration Certification Scheme):</strong><br>
          Guarantees your installer and solar products meet strict UK quality and safety standards. MCS certification is required for eligibility for government incentives and ensures your installation is reliable and high performing.
        </div>
      </div>
      <div class="accredit-card" tabindex="0">
        <button class="accredit-card-btn" type="button" aria-expanded="false">
          <img src="assets/epvs logi.jpeg" alt="EPVS" />
          <span>EPVS</span>
        </button>
        <div class="accredit-card-desc">
          <strong>EPVS (Energy Performance Validation Scheme):</strong><br>
          Protects you from misleading sales claims by ensuring all performance figures and savings estimates from your installer are independently validated and accurate.
        </div>
      </div>
      <div class="accredit-card" tabindex="0">
        <button class="accredit-card-btn" type="button" aria-expanded="false">
          <img src="assets/hies-cc-logo-2.png" alt="HIES" />
          <span>HIES</span>
        </button>
        <div class="accredit-card-desc">
          <strong>HIES (Home Insulation & Energy Systems):</strong><br>
          Provides consumer protection including deposit and warranty insurance, dispute resolution, and ensures you’re covered if anything goes wrong with your solar purchase.
        </div>
      </div>
      <div class="accredit-card" tabindex="0">
        <button class="accredit-card-btn" type="button" aria-expanded="false">
          <img src="assets/NAPIT-NEW-LOGO.jpg" alt="NAPIT" />
          <span>NAPIT</span>
        </button>
        <div class="accredit-card-desc">
          <strong>NAPIT (National Association of Professional Inspectors and Testers):</strong><br>
          Certifies electrical safety and compliance of your installer, ensuring your solar system is installed to the latest regulations and standards.
        </div>
      </div>
      <div class="accredit-card" tabindex="0">
        <button class="accredit-card-btn" type="button" aria-expanded="false">
          <img src="assets/trading-standards-uk-logo.png" alt="Trading Standards" />
          <span>Trading Standards</span>
        </button>
        <div class="accredit-card-desc">
          <strong>Trading Standards:</strong><br>
          Ensures solar businesses comply with UK consumer laws and codes of practice, protecting you from unfair sales and poor business practices.
        </div>
      </div>
      <div class="accredit-card" tabindex="0">
        <button class="accredit-card-btn" type="button" aria-expanded="false">
          <img src="assets/tm_primary_logo_rgb.jpg" alt="TrustMark" />
          <span>TrustMark</span>
        </button>
        <div class="accredit-card-desc">
          <strong>TrustMark:</strong><br>
          Government-endorsed scheme ensuring your solar installer is thoroughly vetted for quality, customer service, and trading practices.
        </div>
      </div>
      <div class="accredit-card" tabindex="0">
        <button class="accredit-card-btn" type="button" aria-expanded="false">
          <img src="assets/Financial_Conduct_Authority_logo.svg.png" alt="FCA" />
          <span>FCA</span>
        </button>
        <div class="accredit-card-desc">
          <strong>FCA (Financial Conduct Authority):</strong><br>
          Regulates finance providers and credit agreements, protecting you if you choose to finance your solar system, ensuring fair, clear, and legal financial products.
        </div>
      </div>
    </div>
  </section>

  <section id="facebook-feed" class="facebook-feed-section">
    <h2>Latest from Our Facebook Page</h2>
    <div id="fb-feed">Loading posts…</div>
  </section>

  <section id="quote" class="section">
    <h2>Request a Free Quote</h2>
    <form action="https://formspree.io/f/mldnarjp" method="POST" class="quote-form">
      <input type="text" name="name" placeholder="Full Name" required autocomplete="name">
      <input type="text" name="address" id="quote-address" placeholder="Start typing your address…" required autocomplete="street-address">
      <input type="email" name="email" placeholder="Email Address" required autocomplete="email">
      <input type="tel" name="phone" placeholder="Phone Number" required autocomplete="tel">
      <input type="text" name="unitrate" placeholder="Electricity Unit Rate (p/kWh)" required>
      <input type="text" name="annualspend" placeholder="Annual Electricity Spend (£)" required>
      <button type="submit">Send My Quote Request</button>
    </form>
  </section>

  <footer>
    <p>&copy; 2025 Let’s Talk About Solar. All rights reserved.</p>
  </footer>

  <script>
    // Facebook Feed Fetcher (using the new access token)
    (function() {
      const PAGE_ID = "1065220185700265";
      const PAGE_ACCESS_TOKEN = "EAAPIzZBbGt6kBOZBSOCOOuBKIZC3E8yAp8LZALPDrD4VB9KdSnhRCjZCYhFoREmst5lL78Jg4ZCd4Xab1uBOpIrnb2796AbNJEEWGfqa4WGjGghQA7AcfPOohnwNfgupUAt15JFTiQvd55RLoFlpsyJIjRxZBtKGg8GNUCe2Th4v0eW8Maexul6MbDdeYbtSdiyrW50aoA6DzM3WQngob9CDwCuFW40QU7umJSYzoIZB2NsZD";
      const url = `https://graph.facebook.com/v19.0/${PAGE_ID}/posts?fields=message,created_time,permalink_url,full_picture&access_token=${PAGE_ACCESS_TOKEN}`;
      fetch(url)
        .then(r => r.json())
        .then(data => {
          const container = document.getElementById('fb-feed');
          if (data && data.data && data.data.length > 0) {
            container.innerHTML = data.data.map(post => `
              <div class="fb-post">
                <div class="fb-date">${new Date(post.created_time).toLocaleString()}</div>
                <div class="fb-message">${post.message ? post.message.replace(/\n/g, "<br>") : "<em>No text content</em>"}</div>
                ${post.full_picture ? `<img src="${post.full_picture}" alt="Post image" style="max-width:100%;border-radius:8px;margin:0.6em 0;">` : ""}
                <a class="fb-link" href="${post.permalink_url}" target="_blank">View on Facebook</a>
              </div>
            `).join('');
          } else {
            container.innerHTML = "<p>No posts found, or token expired/insufficient permissions.</p>";
          }
        })
        .catch(err => {
          document.getElementById('fb-feed').innerHTML = "<p>Error fetching posts.</p>";
          console.error(err);
        });
    })();

    let lastScroll = 0;
    const nav = document.querySelector("nav");
    window.addEventListener("scroll", () => {
      const currentScroll = window.pageYOffset;
      nav.classList.toggle("hidden", currentScroll > lastScroll && currentScroll > 100);
      lastScroll = currentScroll;
    });

    // Orientation section logic (Street View only)
    let autocomplete, lastPlaceLocation = null, panoMap = null;
    let orientationFactor = 1;

    function mapsApiLoaded() {
      if (typeof initMap === "function") initMap();
      if (typeof initQuoteAddressAutocomplete === "function") initQuoteAddressAutocomplete();
    }

    function initMap() {
      const input = document.getElementById("addressInput");
      autocomplete = new google.maps.places.Autocomplete(input, {
        componentRestrictions: { country: 'uk' },
        fields: ["geometry", "formatted_address", "address_components"],
        types: ["address"]
      });

      autocomplete.addListener("place_changed", () => {
        const place = autocomplete.getPlace();
        if (!place.geometry || !place.geometry.location) {
          alert("No details available for input: '" + place.name + "'");
          lastPlaceLocation = null;
          return;
        }
        lastPlaceLocation = place.geometry.location;
        const viewport = place.geometry.viewport;
        let orientation = "Unknown";
        let explanation = "";
        orientationFactor = 0.9;

        if (viewport) {
          const ne = viewport.getNorthEast();
          const sw = viewport.getSouthWest();
          const angle = Math.atan2(ne.lat() - sw.lat(), ne.lng() - sw.lng()) * (180 / Math.PI);

          if (angle > -45 && angle <= 45) {
            orientation = "East";
            orientationFactor = 0.85;
            explanation = "Your front roof likely faces East and the rear West. A solar system can still work well with morning sunlight.";
          } else if (angle > 45 && angle <= 135) {
            orientation = "North";
            orientationFactor = 0.75;
            explanation = "Your front roof likely faces North and the rear South. South-facing roofs are ideal for solar.";
          } else if (angle > -135 && angle <= -45) {
            orientation = "South";
            orientationFactor = 1.0;
            explanation = "Your front roof likely faces South and the rear North. This is excellent for solar efficiency.";
          } else {
            orientation = "West";
            orientationFactor = 0.8;
            explanation = "Your front roof likely faces West and the rear East. Good for catching late afternoon sunlight.";
          }
        }

        document.getElementById("orientationResult").innerHTML =
          `<strong>Estimated Roof Orientation:</strong> ${orientation}<br><em>${explanation}</em>`;
      });
    }

    function initQuoteAddressAutocomplete() {
      var input = document.getElementById('quote-address');
      if (!input) return;
      var options = {
        componentRestrictions: { country: 'uk' },
        fields: ["formatted_address", "geometry"],
        types: ["address"]
      };
      var autocomplete = new google.maps.places.Autocomplete(input, options);
      autocomplete.setBounds(new google.maps.LatLngBounds(
        new google.maps.LatLng(49.9, -7.6),
        new google.maps.LatLng(58.7, 1.8)
      ));
    }

    function toggleStreetView() {
      const container = document.getElementById("streetview-container");
      container.style.display = (container.style.display === "none" || container.style.display === "") ? "block" : "none";
    }

    // --- SOLAR CALCULATOR (with standing charge and finance offset, UPDATED for homeDay/outDay radio) ---
    let latestSavingsPerYear = 0;
    let latestAnnualSpend = 0;
    document.getElementById("calcForm").addEventListener("submit", function (e) {
      e.preventDefault();
      const rate = parseFloat(document.getElementById("rate").value);
      const standing = parseFloat(document.getElementById("standing").value);
      const usage = parseFloat(document.getElementById("usage").value);
      const battery = document.getElementById("battery").checked;

      // Radio logic
      const homeAllDay = document.getElementById("homeDay").checked;
      let selfConsumptionRatio;
      if (battery) {
        selfConsumptionRatio = homeAllDay ? 0.8 : 0.6;
      } else {
        selfConsumptionRatio = homeAllDay ? 0.65 : 0.4;
      }
      const systemSizeKW = 3.68;
      const panelSystemKW = 9 * 0.46;
      const kwhPerKWp = 1050;
      const estimatedAnnualGen = Math.min(systemSizeKW, panelSystemKW) * kwhPerKWp * orientationFactor;
      let usableBatteryKWh = 0;
      let batteryCyclesPerYear = 0;
      let batterySelfUse = 0;
      if (battery) {
        usableBatteryKWh = 5 * 0.9 * 0.9;
        batteryCyclesPerYear = 365;
        batterySelfUse = Math.min(estimatedAnnualGen, usableBatteryKWh * batteryCyclesPerYear);
      }
      let selfUsedKWh = estimatedAnnualGen * selfConsumptionRatio;
      if (battery) {
        selfUsedKWh = Math.min(selfUsedKWh + batterySelfUse, estimatedAnnualGen, usage);
      }

      const annualStanding = standing * 365 / 100;
      const billUsage = rate * usage / 100;
      const annualSpend = billUsage + annualStanding;
      latestAnnualSpend = annualSpend;

      let annualSavingsArr = [];
      let price = rate;
      let cumulative = 0;
      for (let year = 1; year <= 10; year++) {
        let yearSavings = (selfUsedKWh * price) / 100;
        cumulative += yearSavings;
        annualSavingsArr.push({
          year,
          price: price.toFixed(2),
          savings: yearSavings.toFixed(2),
          cumulative: cumulative.toFixed(2)
        });
        price *= 1.0704;
      }
      let tableRows = annualSavingsArr.map(row =>
        `<tr><td>Year ${row.year}</td><td>£${row.savings}</td><td>${row.price}p/kWh</td><td>£${row.cumulative}</td></tr>`
      ).join('');
      const presenceText = homeAllDay
        ? "You're home during the day"
        : "You're out during the day";
      const calcResult = document.getElementById("calcResult");
      latestSavingsPerYear = parseFloat(annualSavingsArr[0].savings);
      calcResult.innerHTML = `
        <div style="margin-bottom:1.1em;">
          <h3>Estimated Annual Savings (Year 1): £${annualSavingsArr[0].savings}</h3>
          <p>Your system is estimated to generate <strong>${estimatedAnnualGen.toFixed(0)} kWh</strong> per year.</p>
          <p>Annual self-used solar: <strong>${selfUsedKWh.toFixed(0)} kWh</strong> (${(100*selfUsedKWh/usage).toFixed(0)}% of your usage${battery ? ' with 5kWh battery' : ''}, ${presenceText})</p>
          <p><b>Your annual energy spend (inc. standing charge): £${annualSpend.toFixed(2)}</b></p>
        </div>
        <h4>Projected Savings Over 10 Years (with 7.04% price increase per year):</h4>
        <table style="margin:auto;border-collapse:collapse;">
          <tr>
            <th>Year</th>
            <th>Annual Savings</th>
            <th>Price per kWh</th>
            <th>Cumulative Savings</th>
          </tr>
          ${tableRows}
        </table>
        <p style="font-size:0.95em;color:#5a9;">These are estimated figures. Fill in the free quote form for a full breakdown.</p>
      `;

      showFinanceOffset();
    });

    function showFinanceOffset() {
      const section = document.getElementById("finance-offset-section");
      section.style.display = "block";
      updateFinanceOffset();
    }

    function updateFinanceOffset() {
      const installCost = 9500;
      const deposit = parseFloat(document.getElementById("deposit-amount")?.value) || 0;
      const loanAmount = installCost - deposit;
      const years = 10;
      const n = years * 12;
      const rate = 0.099;
      const monthlyRate = rate / 12;
      let monthly = (loanAmount * monthlyRate) / (1 - Math.pow(1 + monthlyRate, -n));
      const totalFinance = (monthly * n) + deposit;

      const savingsPerYear = latestSavingsPerYear || 800;
      const savingsPerMonth = savingsPerYear / 12;
      const totalSavings10y = savingsPerYear * years;
      const annualSpend = latestAnnualSpend || 1200;
      const totalElec10y = annualSpend * years;

      const netMonthly = monthly - savingsPerMonth;
      const net10y = (monthly * n) - totalSavings10y + deposit;
      const diff = totalElec10y - net10y;

      const summary = `
        <p>
          <b>Typical system cost:</b> £${installCost.toLocaleString()}
          &nbsp; <b>Deposit:</b> £${deposit.toLocaleString()}<br>
          <b>Monthly finance payment:</b> £${monthly.toFixed(2)}<br>
          <b>Estimated average monthly savings:</b> £${savingsPerMonth.toFixed(2)}
        </p>
        <p>
          <b>Net outgoing (finance payment minus savings):</b> <span>${netMonthly > 0 ? "£"+netMonthly.toFixed(2)+"/month" : "<span class='diff-positive'>£"+netMonthly.toFixed(2)+"/month</span>"}</span>
        </p>
        <hr>
        <p>
          <b>Total cost with solar & finance over 10 years:</b> £${net10y.toFixed(2)}<br>
          <b>Total paid for electricity (no solar) over 10 years:</b> £${totalElec10y.toFixed(2)}<br>
          <b>Difference:</b> <span class="${diff > 0 ? 'diff-positive' : 'diff-negative'}">${diff > 0 ? "You save £"+diff.toFixed(2) : "Solar+finance costs £"+Math.abs(diff).toFixed(2)+" more"}</span>
        </p>
      `;
      document.getElementById("finance-offset-summary").innerHTML = summary;
    }

    document.getElementById("depositForm").addEventListener("submit", function(e){
      e.preventDefault();
      updateFinanceOffset();
    });

    function toggleHistoric() {
      let g = document.getElementById('historic-graph');
      g.style.display = (g.style.display === 'none' || g.style.display === '') ? 'block' : 'none';
      if (g.style.display === 'block' && !window._historicChartLoaded) {
        drawPriceChart();
        window._historicChartLoaded = true;
      }
    }
    function drawPriceChart() {
      const ctx = document.getElementById('pricesChart').getContext('2d');
      const years = [
        2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,
        2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,
        2020,2021,2022,2023,2024,2025
      ];
      const prices = [
        7.0,7.3,7.2,7.1,7.4,8.2,10.0,10.6,13.3,13.9,
        13.7,14.5,15.5,15.6,15.6,15.2,14.4,14.4,15.0,17.2,
        17.2,19.0,28.0,30.0,28.5,27.5
      ];
      new Chart(ctx, {
        type: 'line',
        data: {
          labels: years,
          datasets: [{
            label: 'UK Domestic Electricity Price (p/kWh)',
            data: prices,
            borderColor: '#11998e',
            backgroundColor: 'rgba(17,153,142,0.14)',
            tension: 0.22,
            pointBackgroundColor: '#1866e6',
            pointRadius: 4,
            fill: true
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { display: true },
            tooltip: { enabled: true }
          },
          scales: {
            y: {
              beginAtZero: true,
              title: { display: true, text: 'pence per kWh' }
            },
            x: {
              title: { display: true, text: 'Year' }
            }
          }
        }
      });
    }

    // Trust card open/close logic
    document.querySelectorAll('.accredit-card-btn').forEach(btn => {
      btn.addEventListener('click', function() {
        document.querySelectorAll('.accredit-card').forEach(card => {
          if (card.contains(btn)) {
            card.classList.toggle('active');
            btn.setAttribute('aria-expanded', card.classList.contains('active'));
          } else {
            card.classList.remove('active');
            card.querySelector('.accredit-card-btn').setAttribute('aria-expanded', 'false');
          }
        });
      });
      btn.addEventListener('keydown', function(e) {
        if (e.key === "Enter" || e.key === " " || e.key === "Spacebar") {
          e.preventDefault();
          btn.click();
        }
      });
    });
  </script>
</body>
</html>
