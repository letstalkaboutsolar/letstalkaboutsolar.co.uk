<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Only one Google Maps/Places script is needed, so we load it once, with a combined callback -->
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC0y8SNlXSgKW0aHxXofroM4_aPqzaIrFQ&libraries=places&callback=mapsApiLoaded" async defer></script>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Let’s Talk About Solar</title>
  <meta name="description" content="Clear, friendly, and honest solar advice for UK homeowners. Discover real savings, trusted installers, and smart solar tools." />
  <link href="https://fonts.googleapis.com/css2?family=Patrick+Hand&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #72bcd4;
      --secondary: #eaf9ff;
      --accent: #ffd700;
      --background: #f4fbff;
      --card: #fff;
      --text: #2c3e50;
      --radius: 20px;
      --shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
    }
    * { box-sizing: border-box; }
    html, body {
      margin: 0;
      padding: 0;
      background: var(--background);
      font-family: 'Patrick Hand', cursive;
      color: var(--text);
      scroll-behavior: smooth;
    }
    nav {
      position: fixed;
      top: 0;
      width: 100%;
      background: var(--card);
      box-shadow: var(--shadow);
      padding: 1rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 100;
      transition: top 0.3s;
      height: auto;
    }
    nav.hidden { top: -100px; }
    .logo { font-size: 1.5rem; font-weight: bold; color: var(--primary); }
    nav ul {
      list-style: none;
      display: flex;
      gap: 1.5rem;
      margin: 0;
      padding: 0;
    }
    nav ul li a {
      text-decoration: none;
      color: var(--text);
      font-size: 1.1rem;
      padding: 0.5rem 0.8rem;
      border-radius: 999px;
      transition: background 0.18s;
    }
    nav ul li a.cta-nav {
      background: var(--primary);
      color: white;
      padding: 0.5rem 1rem;
    }
    nav ul li a:hover,
    nav ul li a.cta-nav:hover {
      background: var(--secondary);
      color: var(--primary);
    }
    .hero {
      padding: 4rem 2rem 2rem;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      align-items: center;
      background: linear-gradient(to right, #e0f7ff, #ffffff);
      margin-top: 72px;
    }
    .hero-text {
      max-width: 480px;
      padding: 1rem;
    }
    .hero-text h1 {
      font-size: 2.2rem;
      color: var(--primary);
      margin: 0 0 1rem;
    }
    .hero-text p {
      font-size: 1.1rem;
      margin-bottom: 1rem;
    }
    .cta {
      background: var(--primary);
      color: white;
      padding: 0.75rem 1.5rem;
      text-decoration: none;
      border-radius: 999px;
      font-size: 1rem;
      display: inline-block;
    }
    .section { padding: 3rem 1rem; text-align: center; }
    .benefit-cards, .trust-logos {
      display: flex;
      flex-wrap: wrap;
      gap: 2rem;
      justify-content: center;
      margin-top: 2rem;
    }
    .benefit-card, .trust-logo {
      background: var(--card);
      padding: 1.5rem;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      max-width: 250px;
    }
    .benefit-card img, .trust-logo img {
      width: 60px;
      height: 60px;
      object-fit: contain;
      margin-bottom: 1rem;
    }
    .calculator, .quote-form {
      max-width: 500px;
      margin: 0 auto;
      background: var(--card);
      padding: 2rem;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
    }
    label, input, button {
      display: block;
      width: 100%;
      font-size: 1rem;
      margin-top: 1rem;
      font-family: 'Patrick Hand', cursive;
    }
    input {
      padding: 0.6rem;
      border: 1px solid #ccc;
      border-radius: 10px;
    }
    #rate { box-shadow: 0 2px 8px #e3f0fc; }
    button {
      background: var(--primary);
      color: white;
      padding: 0.75rem;
      border: none;
      border-radius: 999px;
      cursor: pointer;
    }
    #solar-toolkit {
      display: flex;
      flex-wrap: wrap;
      gap: 2rem;
      justify-content: center;
      align-items: flex-start;
      text-align: left;
    }
    #solar-toolkit > div {
      flex: 1 1 320px;
      min-width: 280px;
      max-width: 450px;
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 2rem;
      margin-bottom: 0;
    }
    #solar-toolkit h2 {
      text-align: center;
    }
    @media (max-width: 950px) {
      #solar-toolkit {
        flex-direction: column;
        align-items: stretch;
        text-align: center;
      }
      #solar-toolkit > div {
        margin: 0 auto 2rem auto;
      }
    }
    #news-list {
      list-style: none;
      max-width: 700px;
      margin: 1.3rem auto 0 auto;
      padding: 0 0.6em;
      font-size: 1.05rem;
      color: #2c3e50;
    }
    #news-list li {
      margin-bottom: 1.1em;
      line-height: 1.5;
      border-bottom: 1px solid #e3f0fc;
      padding-bottom: 0.6em;
    }
    #news-list a {
      color: var(--primary);
      text-decoration: none;
      font-weight: 600;
      transition: color 0.14s;
    }
    #news-list a:hover {
      color: #155a92;
      text-decoration: underline;
    }
    #news-list span {
      color: #888;
      font-size: 0.93em;
    }
    footer {
      background: var(--primary);
      color: white;
      padding: 2rem;
      text-align: center;
      margin-top: 3rem;
      border-radius: var(--radius) var(--radius) 0 0;
      font-size: 0.9rem;
    }
    @media (max-width: 600px) {
      nav {
        padding: 0.4rem 0.7rem;
        background: rgba(255,255,255,0.97);
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        height: auto;
      }
      .logo {
        font-size: 1rem;
        padding: 0.2rem 0;
      }
      nav ul {
        gap: 0.8rem;
        overflow-x: auto;
        white-space: nowrap;
        flex-wrap: nowrap;
      }
      nav ul li a {
        font-size: 0.95rem;
        padding: 0.3rem 0.7rem;
      }
      nav ul li a.cta-nav {
        padding: 0.35rem 0.8rem;
      }
      .hero {
        padding: 2.2rem 0.5rem 1rem 0.5rem;
        margin-top: 56px;
      }
      .hero-text h1 {
        font-size: 1.2rem;
      }
      .benefit-cards, .trust-logos {
        flex-direction: column;
        align-items: center;
        gap: 1.2rem;
      }
      .benefit-card, .trust-logo {
        max-width: 98vw;
        padding: 1.2rem 0.7rem;
      }
      .section {
        padding: 1.6rem 0.2rem;
      }
      #solar-toolkit {
        flex-direction: column;
        align-items: stretch;
        text-align: center;
      }
      #solar-toolkit > div {
        margin: 0 auto 2rem auto;
      }
    }
  </style>
</head>
<body>
  <nav id="navbar">
    <div class="logo">Let’s Talk About Solar</div>
    <ul>
      <li><a href="#hero">Home</a></li>
      <li><a href="#benefits">Why Solar?</a></li>
      <li><a href="#orientation">Orientation</a></li>
      <li><a href="#calculator">Savings</a></li>
      <li><a href="#trust">Trust</a></li>
      <li><a href="#quote" class="cta-nav">Get Quote</a></li>
    </ul>
  </nav>

  <section class="hero" id="hero">
    <div class="hero-text">
      <h1>Sunshine Meets Smart Savings</h1>
      <p>See how solar can protect your bills and power your future.</p>
      <a href="#quote" class="cta">Get My Free Quote</a>
    </div>
    <!-- Removed the hero-img with cartoon solar panel -->
  </section>

  <section id="benefits" class="section">
    <h2>Why Solar?</h2>
    <div class="benefit-cards">
      <div class="benefit-card">
        <img src="https://cdn-icons-png.flaticon.com/512/3135/3135715.png" alt="Money saving GBP icon">
        <p>Save money on your bills from day one.</p>
      </div>
      <div class="benefit-card">
        <img src="https://cdn-icons-png.flaticon.com/512/3103/3103446.png" alt="Battery storage icon">
        <p>Store your sunshine with battery technology.</p>
      </div>
      <div class="benefit-card">
        <img src="https://cdn-icons-png.flaticon.com/512/2422/2422625.png" alt="Pylon selling to grid icon">
        <p>Sell your surplus energy back to the grid.</p>
      </div>
    </div>
  </section>

  <!-- COMBINED ORIENTATION & CALCULATOR SECTION -->
  <section id="solar-toolkit" class="section">
    <div>
      <h2>Check Your Roof Orientation</h2>
      <p>Enter your address to estimate your solar potential.</p>
      <input id="addressInput" type="text" placeholder="Enter your address" style="max-width:350px;margin:0 auto 1rem auto;display:block;" />
      <button id="toggleMapBtn" onclick="toggleStreetView()" style="margin:1rem 0 1.2rem 0;padding:0.7rem 1.3rem;border-radius:999px;background:#72bcd4;color:#fff;font-weight:bold;font-size:1rem;border:none;box-shadow:0 2px 8px rgba(114,188,212,0.07);cursor:pointer;">
        Show Street View
      </button>
      <div id="streetview-container" style="width:100%;max-width:400px;height:200px;display:none;border-radius:18px;overflow:hidden;margin:0 auto 1rem auto;background:#f4fbff;">
        <div id="pano" style="width:100%;height:100%;"></div>
      </div>
      <p id="orientationResult" style="margin-top: 1rem; font-weight: bold;"></p>
    </div>
    <div>
      <h2>Solar Savings Calculator</h2>
      <form id="calcForm" class="calculator">
        <label for="rate">Electricity unit rate (p/kWh):</label>
        <input type="number" id="rate" placeholder="e.g. 25" required>
        <label for="usage">Annual electricity usage (kWh):</label>
        <input type="number" id="usage" placeholder="e.g. 4000" required>
        <label><input type="checkbox" id="battery"> Include battery?</label>
        <button type="submit">Calculate</button>
      </form>
      <div id="calcResult"></div>
      <p style="font-size: 0.8rem; margin-top: 1rem; color: gray;">
        This calculation is based on a system with 9 solar panels – if your roof can fit more, your potential savings will be even higher. These are estimated figures and don’t include what you would be exporting per year on top of savings. For a free comprehensive breakdown, fill in the free quote form.
      </p>
    </div>
  </section>

  <section id="energy-news" class="section">
    <h2>Latest UK Energy News</h2>
    <ul id="news-list"><li>Loading news...</li></ul>
    <p style="font-size:0.9rem;color:gray;margin-top:0.5rem;">
      News provided by NewsAPI.org.<br>
      For the most up-to-date information, check back here regularly.
    </p>
  </section>

  <section id="historic-prices" class="section">
    <button onclick="toggleHistoric()" style="font-size:1.1rem;padding:0.5rem 1.5rem;background:#72bcd4;color:#fff;border:none;border-radius:20px;cursor:pointer;">
      Show Historic Electricity Prices (2000-2025)
    </button>
    <div id="historic-graph" style="display:none;margin-top:2rem;">
      <canvas id="pricesChart" width="400" height="200"></canvas>
      <p style="font-size:0.9rem;color:gray;">
        Sources: 
        <a href="https://www.gov.uk/government/statistical-data-sets/annual-domestic-energy-price-statistics" target="_blank">UK Government</a>, 
        <a href="https://www.ons.gov.uk/economy/inflationandpriceindices/datasets/consumerpriceindices" target="_blank">Office for National Statistics (ONS)</a>, 
        <a href="https://www.ofgem.gov.uk/energy-data-and-research/data-portal/retail-market-indicators" target="_blank">Ofgem</a>
      </p>
    </div>
  </section>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <section id="trust" class="section">
    <h2>Who Can You Trust?</h2>
    <div class="trust-logos">
      <a class="trust-logo" href="https://mcscertified.com/" target="_blank">
        <img src="assets/mcs logo.png" alt="MCS Certified" />
        <p><strong>MCS</strong>: Quality guaranteed equipment and installers.</p>
      </a>
      <a class="trust-logo" href="https://www.epvs.co.uk/" target="_blank">
        <img src="assets/epvs logi.jpeg" alt="EPVS" />
        <p><strong>EPVS</strong>: Verified energy savings and performance claims.</p>
      </a>
      <a class="trust-logo" href="https://www.hiesscheme.org.uk/" target="_blank">
        <img src="assets/hies-cc-logo-2.png" alt="HIES" />
        <p><strong>HIES</strong>: Consumer protection from start to finish.</p>
      </a>
      <a class="trust-logo" href="https://www.napit.org.uk/" target="_blank">
        <img src="assets/NAPIT-NEW-LOGO.jpg" alt="NAPIT" />
        <p><strong>NAPIT</strong>: Government-approved installer certification.</p>
      </a>
      <a class="trust-logo" href="https://www.tradingstandards.uk/" target="_blank">
        <img src="assets/trading-standards-uk-logo.png" alt="Trading Standards" />
        <p><strong>Trading Standards</strong>: Ensuring legal and fair business practices.</p>
      </a>
      <a class="trust-logo" href="https://www.trustmark.org.uk/" target="_blank">
        <img src="assets/tm_primary_logo_rgb.jpg" alt="TrustMark" />
        <p><strong>Government TrustMark</strong>: The only government-endorsed quality scheme for trades in and around the home.</p>
      </a>
      <a class="trust-logo" href="https://register.fca.org.uk/" target="_blank">
        <img src="assets/Financial_Conduct_Authority_logo.svg.png" alt="FCA" />
        <p><strong>FCA</strong>: Regulated advice and consumer financial protection.</p>
      </a>
    </div>
  </section>

  <!-- QUOTE FORM WITH ADDRESS AUTOCOMPLETE -->
  <section id="quote" class="section">
    <h2>Request a Free Quote</h2>
    <form action="https://formspree.io/f/mldnarjp" method="POST" class="quote-form">
      <input type="text" name="name" placeholder="Full Name" required autocomplete="name">
      <input type="text" name="address" id="quote-address" placeholder="Start typing your address…" required autocomplete="street-address">
      <input type="email" name="email" placeholder="Email Address" required autocomplete="email">
      <input type="tel" name="phone" placeholder="Phone Number" required autocomplete="tel">
      <input type="text" name="unitrate" placeholder="Electricity Unit Rate (p/kWh)" required>
      <input type="text" name="annualspend" placeholder="Annual Electricity Spend (£)" required>
      <button type="submit">Send My Quote Request</button>
    </form>
  </section>

  <footer>
    <p>&copy; 2025 Let’s Talk About Solar. All rights reserved.</p>
  </footer>

  <!-- MAIN SCRIPTS -->
  <script>
    let lastScroll = 0;
    const nav = document.getElementById("navbar");
    let orientationFactor = 1;

    window.addEventListener("scroll", () => {
      const currentScroll = window.pageYOffset;
      nav.classList.toggle("hidden", currentScroll > lastScroll);
      lastScroll = currentScroll;
    });

    // Orientation section logic (Street View only)
    let autocomplete, lastPlaceLocation = null, panoMap = null;

    // The callback for Google Maps JS API - sets up both orientation and quote form autocomplete
    function mapsApiLoaded() {
      if (typeof initMap === "function") initMap();
      if (typeof initQuoteAddressAutocomplete === "function") initQuoteAddressAutocomplete();
    }

    function initMap() {
      const input = document.getElementById("addressInput");
      autocomplete = new google.maps.places.Autocomplete(input, {
        componentRestrictions: { country: 'uk' },
        fields: ["geometry", "formatted_address", "address_components"],
        types: ["address"]
      });

      autocomplete.addListener("place_changed", () => {
        const place = autocomplete.getPlace();
        if (!place.geometry || !place.geometry.location) {
          alert("No details available for input: '" + place.name + "'");
          lastPlaceLocation = null;
          return;
        }
        lastPlaceLocation = place.geometry.location;
        // Orientation logic
        const viewport = place.geometry.viewport;
        let orientation = "Unknown";
        let explanation = "";
        orientationFactor = 0.9;

        if (viewport) {
          const ne = viewport.getNorthEast();
          const sw = viewport.getSouthWest();
          const angle = Math.atan2(ne.lat() - sw.lat(), ne.lng() - sw.lng()) * (180 / Math.PI);

          if (angle > -45 && angle <= 45) {
            orientation = "East";
            orientationFactor = 0.85;
            explanation = "Your front roof likely faces East and the rear West. A solar system can still work well with morning sunlight.";
          } else if (angle > 45 && angle <= 135) {
            orientation = "North";
            orientationFactor = 0.75;
            explanation = "Your front roof likely faces North and the rear South. South-facing roofs are ideal for solar.";
          } else if (angle > -135 && angle <= -45) {
            orientation = "South";
            orientationFactor = 1.0;
            explanation = "Your front roof likely faces South and the rear North. This is excellent for solar efficiency.";
          } else {
            orientation = "West";
            orientationFactor = 0.8;
            explanation = "Your front roof likely faces West and the rear East. Good for catching late afternoon sunlight.";
          }
        }

        document.getElementById("orientationResult").innerHTML =
          `<strong>Estimated Roof Orientation:</strong> ${orientation}<br><em>${explanation}</em>`;
      });
    }

    // Autocomplete for the quote form address field (UK only, addresses only)
    function initQuoteAddressAutocomplete() {
      var input = document.getElementById('quote-address');
      if (!input) return;
      var options = {
        componentRestrictions: { country: 'uk' },
        fields: ["formatted_address", "geometry"],
        types: ["address"]
      };
      var autocomplete = new google.maps.places.Autocomplete(input, options);
      // Optionally, bias to UK viewport
      autocomplete.setBounds(new google.maps.LatLngBounds(
        new google.maps.LatLng(49.9, -7.6),
        new google.maps.LatLng(58.7, 1.8)
      ));
    }

    // Street View toggle
    function toggleStreetView() {
      const container = document.getElementById("streetview-container");
      const btn = document.getElementById("toggleMapBtn");
      if (container.style.display === 'none' || container.style.display === '') {
        if (!lastPlaceLocation) {
          alert("Please enter your address and select it from the dropdown first.");
          return;
        }
        container.style.display = "block";
        if (!panoMap) {
          panoMap = new google.maps.StreetViewPanorama(
            document.getElementById("pano"),
            {
              position: lastPlaceLocation,
              pov: { heading: 165, pitch: 0 },
              zoom: 1
            }
          );
        } else {
          panoMap.setPosition(lastPlaceLocation);
        }
        btn.innerText = "Hide Street View";
      } else {
        container.style.display = "none";
        btn.innerText = "Show Street View";
      }
    }

    // Updated Solar Savings Calculator
    document.getElementById("calcForm").addEventListener("submit", function (e) {
      e.preventDefault();
      const rate = parseFloat(document.getElementById("rate").value); // pence per kWh
      const usage = parseFloat(document.getElementById("usage").value); // annual usage in kWh
      const battery = document.getElementById("battery").checked;

      // 9 x 460W panels = 4.14kWp, limited by 3.68kW inverter
      const systemSizeKW = 3.68; // kWp
      const panelSystemKW = 9 * 0.46; // 4.14kW, but limited by inverter
      const pitchDeg = 35;

      // UK avg irradiance for 35deg S: ~1050 kWh/kWp/year, adjust for orientation
      const kwhPerKWp = 1050;
      const estimatedAnnualGen = Math.min(systemSizeKW, panelSystemKW) * kwhPerKWp * orientationFactor;

      // Battery settings
      let usableBatteryKWh = 0;
      let batteryCyclesPerYear = 0;
      let batterySelfUse = 0;
      if (battery) {
        // 5kWh battery, 90% usable each way (charge/discharge)
        usableBatteryKWh = 5 * 0.9 * 0.9; // 4.05kWh
        batteryCyclesPerYear = 365;
        batterySelfUse = Math.min(estimatedAnnualGen, usableBatteryKWh * batteryCyclesPerYear);
      }

      // Self-consumption ratio
      let selfConsumptionRatio = battery ? 0.90 : 0.65;

      // Calculate self-used solar kWh
      let selfUsedKWh = estimatedAnnualGen * selfConsumptionRatio;
      if (battery) {
        selfUsedKWh = Math.min(selfUsedKWh + batterySelfUse, estimatedAnnualGen, usage);
      }
      // Savings = self-used solar x rate (converted to £)
      const savings = (selfUsedKWh * rate) / 100;

      // Installation cost estimate (these may be refined as desired)
      const breakEvenEstimate = battery ? 9500 : 7500;

      const calcResult = document.getElementById("calcResult");
      calcResult.innerHTML = `
        <h3>Estimated Annual Savings: £${savings.toFixed(2)}</h3>
        <p>Your system is estimated to generate <strong>${estimatedAnnualGen.toFixed(0)} kWh</strong> per year.</p>
        <p>Annual self-used solar: <strong>${selfUsedKWh.toFixed(0)} kWh</strong> (${(100*selfUsedKWh/usage).toFixed(0)}% of your usage${battery ? ' with 5kWh battery' : ''}).</p>
        <p>Typical installation: <strong>£${breakEvenEstimate.toLocaleString()}</strong></p>
        <p style="font-size:0.95em;color:#888;">This calculation is based on a system with 9 solar panels – if your roof can fit more, your potential savings will be even higher. These are estimated figures and don’t include what you would be exporting per year on top of savings. For a free comprehensive breakdown, fill in the free quote form.</p>
      `;
    });

    // Historic prices chart
    function toggleHistoric() {
      let g = document.getElementById('historic-graph');
      g.style.display = (g.style.display === 'none' || g.style.display === '') ? 'block' : 'none';
      if (g.style.display === 'block' && !window._historicChartLoaded) {
        drawPriceChart();
        window._historicChartLoaded = true;
      }
    }
    function drawPriceChart() {
      const ctx = document.getElementById('pricesChart').getContext('2d');
      const years = [
        2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,
        2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,
        2020,2021,2022,2023,2024,2025
      ];
      const prices = [
        7.0,7.3,7.2,7.1,7.4,8.2,10.0,10.6,13.3,13.9,
        13.7,14.5,15.5,15.6,15.6,15.2,14.4,14.4,15.0,17.2,
        17.2,19.0,28.0,30.0,28.5,27.5
      ];
      new Chart(ctx, {
        type: 'line',
        data: {
          labels: years,
          datasets: [{
            label: 'UK Domestic Electricity Price (p/kWh)',
            data: prices,
            borderColor: '#72bcd4',
            backgroundColor: 'rgba(114,188,212,0.15)',
            tension: 0.25,
            pointBackgroundColor: '#ffd700',
            pointRadius: 5,
            fill: true
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { display: true },
            tooltip: { enabled: true }
          },
          scales: {
            y: {
              beginAtZero: true,
              title: { display: true, text: 'pence per kWh' }
            },
            x: {
              title: { display: true, text: 'Year' }
            }
          }
        }
      });
    }

    // News API for gas and electricity price news
    fetch('https://newsapi.org/v2/everything?q=(energy+OR+electricity+OR+gas)+UK+prices&language=en&sortBy=publishedAt&pageSize=5&apiKey=6c8d21b5a67a48bf8e1b5d7e20b6a6c5')
      .then(res => res.json())
      .then(data => {
        const list = document.getElementById('news-list');
        if (!data.articles || !data.articles.length) {
          list.innerHTML = "<li>No news found right now.</li>";
          return;
        }
        list.innerHTML = "";
        data.articles.forEach(article => {
          const item = document.createElement('li');
          item.innerHTML = `<a href="${article.url}" target="_blank">${article.title}</a> <span>(${new Date(article.publishedAt).toLocaleDateString()})</span>`;
          list.appendChild(item);
        });
      })
      .catch(() => {
        document.getElementById('news-list').innerHTML = "<li>Unable to fetch news at this time.</li>";
      });
  </script>
</body>
</html>
